<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
<title><![CDATA[Emacs con esteroides - ubuntu]]></title>
<description><![CDATA[Emacs con esteroides - ubuntu]]></description>
<link>https://mcasrom.github.io/Blogging-con-Emacs-y-AI//tag-ubuntu.html</link>
<lastBuildDate>Sun, 08 Jun 2025 23:38:17 +0200</lastBuildDate>
<item>
  <title><![CDATA[¿Formo Parte de una Botnet? Guía Avanzada de Detección y Prevención en Linux]]></title>
  <description><![CDATA[
<div id="outline-container-org6ec2f7a" class="outline-2">
<h2 id="org6ec2f7a">Introducción</h2>
<div class="outline-text-2" id="text-org6ec2f7a">
<p>
Una <b>botnet</b> es una red de dispositivos comprometidos que, sin el conocimiento del usuario, son controlados remotamente por atacantes para ejecutar acciones maliciosas como ataques DDoS, minería de criptomonedas, envío masivo de spam, escaneo de redes o distribución de malware.
</p>

<p>
Ubuntu, por ser un sistema Linux ampliamente utilizado, no es inmune. Si bien su arquitectura ofrece robustez, un sistema desactualizado, mal configurado o con software vulnerable puede ser fácilmente absorbido por una botnet.
</p>

<p>
En esta guía analizamos en profundidad cómo detectar señales de compromiso, qué herramientas usar, cómo interpretar sus salidas, y qué medidas tomar en caso de confirmarse una infección.
</p>



<figure id="orgca0a880">
<img src="images/detect-botnet.png" alt="detect-botnet.png">

</figure>
</div>
</div>
<div id="outline-container-orgf90135a" class="outline-2">
<h2 id="orgf90135a">Indicadores de Compromiso en Sistemas Ubuntu</h2>
<div class="outline-text-2" id="text-orgf90135a">
</div>
<div id="outline-container-org5d4d138" class="outline-3">
<h3 id="org5d4d138">Comportamiento del sistema</h3>
<div class="outline-text-3" id="text-org5d4d138">
<ul class="org-ul">
<li>Consumo anormal de CPU/RAM sin procesos legítimos que lo justifiquen.</li>
<li>Congelamientos o lentitud inesperada, especialmente tras el arranque.</li>
<li>Reducción de espacio en disco sin archivos visibles que lo expliquen.</li>
<li>Nuevas conexiones de red o puertos abiertos sin que se haya instalado ningún servicio.</li>
</ul>
</div>
</div>
<div id="outline-container-orga3735ae" class="outline-3">
<h3 id="orga3735ae">Análisis forense inicial</h3>
<div class="outline-text-3" id="text-orga3735ae">
<p>
Usa `uptime` y `last` para identificar sesiones prolongadas y tiempos de actividad sospechosos.
</p>

<div class="org-src-container">
<pre class="src src-bash"><code>uptime
last
</code></pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org2ca65ee" class="outline-2">
<h2 id="org2ca65ee">Revisión Detallada del Sistema</h2>
<div class="outline-text-2" id="text-org2ca65ee">
</div>
<div id="outline-container-orgf2c0610" class="outline-3">
<h3 id="orgf2c0610">1. Monitorización de Procesos</h3>
<div class="outline-text-3" id="text-orgf2c0610">
<div class="org-src-container">
<pre class="src src-bash"><code>ps aux --sort=-%cpu | head
top
htop
</code></pre>
</div>

<p>
Busca procesos con nombres engañosos como:
</p>
<ul class="org-ul">
<li>`kworker/0:0` falsos (cuando hay varios iguales).</li>
<li>`crond` o `sshd` duplicados.</li>
<li>Procesos binarios ejecutados desde `/tmp`, `/dev/shm` o `/var/tmp`.</li>
</ul>
</div>
</div>
<div id="outline-container-org5f71543" class="outline-3">
<h3 id="org5f71543">2. Conexiones de Red Activas</h3>
<div class="outline-text-3" id="text-org5f71543">
<div class="org-src-container">
<pre class="src src-bash"><code>sudo ss -pant
sudo netstat -plant
</code></pre>
</div>

<p>
Analiza conexiones a IPs externas en puertos altos (4444, 6667, 1337), típicos en botnets. Complementa con `whois` o `ipinfo.io` para identificar destinos.
</p>
</div>
</div>
<div id="outline-container-orgf58bd27" class="outline-3">
<h3 id="orgf58bd27">3. Escaneo de Rootkits</h3>
<div class="outline-text-3" id="text-orgf58bd27">
<div class="org-src-container">
<pre class="src src-bash"><code>sudo apt install chkrootkit rkhunter
sudo chkrootkit
sudo rkhunter --update &amp;&amp; sudo rkhunter --checkall
</code></pre>
</div>

<p>
Estos buscan manipulaciones en binarios del sistema, hooks en bibliotecas, rootkits en el kernel y alteraciones de permisos.
</p>
</div>
</div>
<div id="outline-container-orgfef2f19" class="outline-3">
<h3 id="orgfef2f19">4. Revisión del Sistema de Archivos</h3>
<div class="outline-text-3" id="text-orgfef2f19">
<p>
Busca binarios ejecutables en ubicaciones sospechosas:
</p>

<div class="org-src-container">
<pre class="src src-bash"><code>find / -type f -perm -111 -exec ls -l {} <span style="color: #a44185;">\;</span> 2&gt;/dev/null | grep -E <span style="color: #a44185;">"/tmp|/var/tmp|/dev/shm"</span>
</code></pre>
</div>

<p>
Revisa scripts automatizados en cron que podrían persistir malware:
</p>

<div class="org-src-container">
<pre class="src src-bash"><code>crontab -l
ls -la /etc/cron.*
</code></pre>
</div>
</div>
</div>
<div id="outline-container-orgb8ec3b5" class="outline-3">
<h3 id="orgb8ec3b5">5. Análisis de Logs</h3>
<div class="outline-text-3" id="text-orgb8ec3b5">
<div class="org-src-container">
<pre class="src src-bash"><code>journalctl -xe | grep -i ssh
grep -i <span style="color: #a44185;">"reverse shell"</span> /var/log/*
</code></pre>
</div>

<p>
Busca conexiones entrantes inesperadas, cambios de permisos, autenticaciones fallidas repetidas o sesiones abiertas fuera del horario normal.
</p>
</div>
</div>
<div id="outline-container-org6a02bc9" class="outline-3">
<h3 id="org6a02bc9">6. Inspección de Tráfico de Red</h3>
<div class="outline-text-3" id="text-org6a02bc9">
<p>
Puedes usar `tcpdump` o `wireshark` para analizar tráfico en tiempo real.
</p>

<div class="org-src-container">
<pre class="src src-bash"><code>sudo tcpdump -i any -n port not 22 and not 80 and not 443
</code></pre>
</div>

<p>
Busca patrones de beaconing o actividad periódica hacia una misma IP.
</p>
</div>
</div>
<div id="outline-container-org5ecb906" class="outline-3">
<h3 id="org5ecb906">7. Auditoría del Sistema</h3>
<div class="outline-text-3" id="text-org5ecb906">
<div class="org-src-container">
<pre class="src src-bash"><code>sudo apt install lynis
sudo lynis audit system
</code></pre>
</div>

<p>
Lynis proporciona un informe completo sobre la postura de seguridad del sistema, servicios activos, vulnerabilidades y configuraciones débiles.
</p>
</div>
</div>
</div>
<div id="outline-container-org7165f76" class="outline-2">
<h2 id="org7165f76">Comprobación de Persistencia y Escalada</h2>
<div class="outline-text-2" id="text-org7165f76">
<p>
Revisa scripts de inicio del sistema:
</p>

<div class="org-src-container">
<pre class="src src-bash"><code>ls -la /etc/init.d/
ls -la ~/.config/autostart/
cat ~/.bashrc | grep -i curl
</code></pre>
</div>

<p>
Algunas botnets modifican `.bashrc`, `.profile` o `.bash<sub>profile</sub>` para reactivar malware tras el reinicio.
</p>
</div>
</div>
<div id="outline-container-org39b0493" class="outline-2">
<h2 id="org39b0493">Evaluación de la Configuración de Red</h2>
<div class="outline-text-2" id="text-org39b0493">
<p>
Verifica los DNS configurados:
</p>

<div class="org-src-container">
<pre class="src src-bash"><code>cat /etc/resolv.conf
</code></pre>
</div>

<p>
DNS no confiables pueden ser usados para redirigir tráfico legítimo hacia dominios de control.
</p>
</div>
</div>
<div id="outline-container-org87ca2e7" class="outline-2">
<h2 id="org87ca2e7">Herramientas Recomendadas Adicionales</h2>
<div class="outline-text-2" id="text-org87ca2e7">
<table border="2" rules="all" frame="all">
<caption class="t-above"><span class="table-number">Table 1:</span> Tabla de herramientas Recomendadadas Adicionales</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Herramienta</th>
<th scope="col" class="org-left">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><b>ufw</b></td>
<td class="org-left">Firewall de configuración sencilla</td>
</tr>

<tr>
<td class="org-left"><b>fail2ban</b></td>
<td class="org-left">Protección contra fuerza bruta</td>
</tr>

<tr>
<td class="org-left"><b>logwatch</b></td>
<td class="org-left">Reportes automáticos de actividad sospechosa</td>
</tr>

<tr>
<td class="org-left"><b>AppArmor</b></td>
<td class="org-left">Contención de procesos potencialmente maliciosos</td>
</tr>

<tr>
<td class="org-left"><b>clamav</b></td>
<td class="org-left">Análisis antivirus</td>
</tr>
</tbody>
</table>

<p>
<br>
</p>

<table border="2" rules="all" frame="all">
<caption class="t-above"><span class="table-number">Table 2:</span> Tabla de herramientas y señales de detección de botnets en Ubuntu</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left"><b>Categoría</b></th>
<th scope="col" class="org-left"><b>Herramienta/Comando</b></th>
<th scope="col" class="org-left"><b>Objetivo</b></th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Análisis de procesos</td>
<td class="org-left">`ps`, `top`, `htop`</td>
<td class="org-left">Detectar procesos ocultos o sospechosos</td>
</tr>

<tr>
<td class="org-left">Conexiones de red</td>
<td class="org-left">`ss`, `netstat`, `tcpdump`</td>
<td class="org-left">Ver conexiones activas y destinos externos</td>
</tr>

<tr>
<td class="org-left">Rootkits y malware</td>
<td class="org-left">`chkrootkit`, `rkhunter`</td>
<td class="org-left">Escaneo de rootkits conocidos</td>
</tr>

<tr>
<td class="org-left">Sistema de archivos</td>
<td class="org-left">`find`, `ls`, `strings`</td>
<td class="org-left">Binarios ocultos en carpetas temporales</td>
</tr>

<tr>
<td class="org-left">Persistencia y cron</td>
<td class="org-left">`crontab`, `systemctl`</td>
<td class="org-left">Ver tareas automatizadas sospechosas</td>
</tr>

<tr>
<td class="org-left">Logs del sistema</td>
<td class="org-left">`journalctl`, `logwatch`</td>
<td class="org-left">Detectar comportamientos anómalos</td>
</tr>

<tr>
<td class="org-left">Auditoría de seguridad</td>
<td class="org-left">`lynis`, `clamav`</td>
<td class="org-left">Estado general de seguridad</td>
</tr>

<tr>
<td class="org-left">Protección y prevención</td>
<td class="org-left">`ufw`, `AppArmor`, `fail2ban`</td>
<td class="org-left">Cortafuegos, defensa y contención</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orga10c30b" class="outline-2">
<h2 id="orga10c30b">Medidas a Tomar en Caso de Sospecha</h2>
<div class="outline-text-2" id="text-orga10c30b">
<ol class="org-ol">
<li><b><b>Desconexión inmediata</b></b> del sistema de redes públicas o internas.</li>
<li><b><b>Respaldo</b></b> de archivos críticos (documentos, claves, configuraciones).</li>
<li>Análisis con <b>chkrootkit</b>, <b>rkhunter</b>, <b>clamav</b>, y revisión manual de procesos y logs.</li>
<li>Si hay evidencia de infección: realizar una <b>reinstalación limpia del sistema</b> desde medios verificados.</li>
<li>Cambiar contraseñas desde un sistema limpio, incluyendo SSH, correo, VPN, etc.</li>
<li>Verificar cuentas SSH en `~/.ssh/authorized<sub>keys</sub>` y rotar llaves si se sospecha compromiso.</li>
<li>Informar a otros administradores o usuarios si el sistema ha participado en ataques (por ética y cumplimiento legal).</li>
</ol>
</div>
</div>
<div id="outline-container-orgff72b1a" class="outline-2">
<h2 id="orgff72b1a">Medidas Preventivas Recomendadas</h2>
<div class="outline-text-2" id="text-orgff72b1a">
<ul class="org-ul">
<li><p>
Mantén el sistema actualizado:  
</p>
<div class="org-src-container">
<pre class="src src-bash"><code>sudo apt update &amp;&amp; sudo apt upgrade -y  
</code></pre>
</div></li>
<li><p>
Configura reglas estrictas con `ufw`:  
</p>
<div class="org-src-container">
<pre class="src src-bash"><code>sudo ufw default deny incoming  
sudo ufw allow ssh  
sudo ufw enable  
</code></pre>
</div></li>
<li>Activa `AppArmor` y configura perfiles para servicios expuestos.</li>
<li>Utiliza llaves SSH en lugar de contraseñas.</li>
<li>Limita el número de servicios activos. Usa `systemctl` para desactivar lo innecesario.</li>
<li>Monitoriza periódicamente con scripts personalizados, <b>tripwire</b>, o herramientas como <b>osquery</b>.</li>
</ul>
</div>
</div>
<div id="outline-container-orgfb1d5e3" class="outline-2">
<h2 id="orgfb1d5e3">Conclusión</h2>
<div class="outline-text-2" id="text-orgfb1d5e3">
<p>
Detectar si tu máquina Ubuntu forma parte de una botnet no es trivial, pero tampoco imposible. Con una mentalidad proactiva y un enfoque sistemático, puedes identificar señales claras de compromiso y tomar medidas para mitigar el riesgo. Un sistema comprometido no debe confiarse ni "limpiarse por partes": la única forma segura de eliminar una botnet es formatear, reinstalar, y adoptar mejores prácticas.
</p>

<p>
La seguridad no es un estado, es un proceso. Inicia hoy una cultura de vigilancia digital.
</p>
</div>
</div>
<div id="outline-container-org07a0eca" class="outline-2">
<h2 id="org07a0eca">Referencias</h2>
<div class="outline-text-2" id="text-org07a0eca">
<ul class="org-ul">
<li><a href="https://wiki.ubuntu.com/Security">https://wiki.ubuntu.com/Security</a></li>
<li><a href="https://cisofy.com/lynis/">https://cisofy.com/lynis/</a></li>
<li><a href="https://github.com/rkhunter/rkhunter">https://github.com/rkhunter/rkhunter</a></li>
<li><a href="https://www.clamav.net/">https://www.clamav.net/</a></li>
</ul>

<blockquote>
<p>
“No hay sistemas seguros, solo sistemas vigilados.”  
— Parafraseando a Bruce Schneier
</p>
</blockquote>
</div>
</div>
<div class="taglist"><a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tags.html">Categoría</a>: <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-linux.html">linux</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-ubuntu.html">ubuntu</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-botnet.html">botnet</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-seguridad.html">seguridad</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-análisis.html">análisis</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-herramientas.html">herramientas</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-prevención.html">prevención</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-tutoriales.html">tutoriales</a> </div>]]></description>
  <category><![CDATA[linux]]></category>
  <category><![CDATA[ubuntu]]></category>
  <category><![CDATA[botnet]]></category>
  <category><![CDATA[seguridad]]></category>
  <category><![CDATA[análisis]]></category>
  <category><![CDATA[herramientas]]></category>
  <category><![CDATA[prevención]]></category>
  <category><![CDATA[tutoriales]]></category>
  <link>https://mcasrom.github.io/Blogging-con-Emacs-y-AI/2025-06-05--formo-parte-de-una-botnet-gu-a-avanzada-de-detecci-n-y-prevenci-n-en-linux.html</link>
  <guid>https://mcasrom.github.io/Blogging-con-Emacs-y-AI/2025-06-05--formo-parte-de-una-botnet-gu-a-avanzada-de-detecci-n-y-prevenci-n-en-linux.html</guid>
  <pubDate>Thu, 05 Jun 2025 14:24:00 +0200</pubDate>
</item>
<item>
  <title><![CDATA[Análisis del Log del Firewall UFW en Ubuntu: Guía Completa para Usuarios]]></title>
  <description><![CDATA[
<div id="outline-container-orgb695410" class="outline-2">
<h2 id="orgb695410">Introducción</h2>
<div class="outline-text-2" id="text-orgb695410">
<p>
El firewall UFW (Uncomplicated Firewall) es una herramienta sencilla y poderosa para gestionar reglas de firewall en Ubuntu. Analizar sus logs es esencial para monitorear la seguridad de tu sistema, detectar intentos de acceso no autorizados y diagnosticar problemas de red. En este post, aprenderás a localizar los logs de UFW, analizar su contenido, resumir los detalles críticos y organizar la información en una tabla `.org` para un análisis eficiente usando Emacs.
</p>
</div>
</div>
<div id="outline-container-orgb2c50c2" class="outline-2">
<h2 id="orgb2c50c2">Localizando los Logs de UFW</h2>
<div class="outline-text-2" id="text-orgb2c50c2">
</div>
<div id="outline-container-org71c6cec" class="outline-3">
<h3 id="org71c6cec">Paso 1: Verificar si UFW está Registrando Eventos</h3>
<div class="outline-text-3" id="text-org71c6cec">
<p>
Primero, asegúrate de que UFW esté habilitado y configurado para generar logs. Ejecuta en la terminal:
</p>

<div class="org-src-container">
<pre class="src src-bash"><code>sudo ufw status
</code></pre>
</div>

<p>
Si ves `logging: on`, UFW está generando logs. Si está desactivado, actívalo con:
</p>

<div class="org-src-container">
<pre class="src src-bash"><code>sudo ufw logging on
</code></pre>
</div>

<p>
Puedes ajustar el nivel de logging (`low`, `medium`, `high`):
</p>

<div class="org-src-container">
<pre class="src src-bash"><code>sudo ufw logging medium
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org4997e59" class="outline-3">
<h3 id="org4997e59">Paso 2: Encontrar el Archivo de Log</h3>
<div class="outline-text-3" id="text-org4997e59">
<p>
UFW suele almacenar sus logs en `/var/log/ufw.log`. Para verificarlo:
</p>

<div class="org-src-container">
<pre class="src src-bash"><code>sudo ls /var/log/ufw.log
</code></pre>
</div>

<p>
Si no existe, los eventos de UFW pueden estar en los logs del sistema, como `/var/log/syslog` o `/var/log/messages`. Usa `grep` para filtrar:
</p>

<div class="org-src-container">
<pre class="src src-bash"><code>sudo grep UFW /var/log/syslog
</code></pre>
</div>

<p>
Para ver los logs en tiempo real:
</p>

<div class="org-src-container">
<pre class="src src-bash"><code>sudo tail -f /var/log/ufw.log
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org5b48314" class="outline-3">
<h3 id="org5b48314">Paso 3: Revisar Logs Rotados</h3>
<div class="outline-text-3" id="text-org5b48314">
<p>
Los logs de UFW pueden rotarse (archivarse). Busca archivos comprimidos:
</p>

<div class="org-src-container">
<pre class="src src-bash"><code>ls /var/log/ufw.log*
</code></pre>
</div>

<p>
Para leer un log comprimido:
</p>

<div class="org-src-container">
<pre class="src src-bash"><code>sudo zcat /var/log/ufw.log.1.gz
</code></pre>
</div>
</div>
</div>
<div id="outline-container-orgdf94d97" class="outline-3">
<h3 id="orgdf94d97">Paso 4: Configuración del Logging</h3>
<div class="outline-text-3" id="text-orgdf94d97">
<p>
Si no ves logs, verifica la configuración en `/etc/ufw/ufw.conf`:
</p>

<div class="org-src-container">
<pre class="src src-bash"><code>sudo cat /etc/ufw/ufw.conf
</code></pre>
</div>

<p>
Busca la línea `LOGLEVEL`. Asegúrate de que no esté en `off`. Por ejemplo:
</p>

<div class="org-src-container">
<pre class="src src-text"><code>LOGLEVEL=medium
</code></pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org5959500" class="outline-2">
<h2 id="org5959500">Análisis de los Logs de UFW</h2>
<div class="outline-text-2" id="text-org5959500">
</div>
<div id="outline-container-orgb5c8ab3" class="outline-3">
<h3 id="orgb5c8ab3">Formato de una Entrada de Log</h3>
<div class="outline-text-3" id="text-orgb5c8ab3">
<p>
Los logs de UFW tienen un formato estándar. Aquí tienes un ejemplo:
</p>

<div class="org-src-container">
<pre class="src src-text"><code>May 29 19:33:45 laptop kernel: [UFW BLOCK] IN=eth0 OUT= MAC=00:15:5d:01:23:45 SRC=192.168.1.100 DST=192.168.1.101 LEN=60 TOS=0x00 PREC=0x00 TTL=64 ID=12345 PROTO=TCP SPT=12345 DPT=80
</code></pre>
</div>

<ul class="org-ul">
<li><b><b>Fecha y hora</b></b>: `May 29 19:33:45`</li>
<li><b><b>Host</b></b>: `laptop`</li>
<li><b><b>Acción</b></b>: `[UFW BLOCK]` (indica que el tráfico fue bloqueado; otras opciones incluyen `[UFW ALLOW]`)</li>
<li><b><b>Interfaz</b></b>: `IN=eth0` (interfaz de entrada)</li>
<li><b><b>Direcciones IP</b></b>: `SRC=192.168.1.100` (origen), `DST=192.168.1.101` (destino)</li>
<li><b><b>Protocolo y puertos</b></b>: `PROTO=TCP SPT=12345 DPT=80` (protocolo TCP, puerto origen 12345, puerto destino 80)</li>
<li><b><b>Otros detalles</b></b>: `LEN`, `TOS`, `TTL`, etc., describen características del paquete.</li>
</ul>
</div>
</div>
<div id="outline-container-org734a2d4" class="outline-3">
<h3 id="org734a2d4">Herramientas para Análisis</h3>
<div class="outline-text-3" id="text-org734a2d4">
<ol class="org-ol">
<li><b><b>Grep para filtrar eventos específicos</b></b>:
<ul class="org-ul">
<li><p>
Bloqueos de una IP específica:
</p>
<div class="org-src-container">
<pre class="src src-bash"><code>sudo grep <span style="color: #a44185;">"SRC=192.168.1.100"</span> /var/log/ufw.log
</code></pre>
</div></li>
<li><p>
Tráfico en un puerto específico:
</p>
<div class="org-src-container">
<pre class="src src-bash"><code>sudo grep <span style="color: #a44185;">"DPT=22"</span> /var/log/ufw.log
</code></pre>
</div></li>
</ul></li>

<li><b><b>Awk para extraer campos</b></b>:
<ul class="org-ul">
<li><p>
Extraer IPs de origen bloqueadas:
</p>
<div class="org-src-container">
<pre class="src src-bash"><code>sudo awk <span style="color: #a44185;">'/UFW BLOCK/ {print $13}'</span> /var/log/ufw.log | sort | uniq
</code></pre>
</div></li>
</ul></li>

<li><b><b>Resumen con `wc` y `uniq`</b></b>:
<ul class="org-ul">
<li><p>
Contar eventos de bloqueo:
</p>
<div class="org-src-container">
<pre class="src src-bash"><code>sudo grep <span style="color: #a44185;">"UFW BLOCK"</span> /var/log/ufw.log | wc -l
</code></pre>
</div></li>
</ul></li>
</ol>
</div>
</div>
<div id="outline-container-orge11e5b9" class="outline-3">
<h3 id="orge11e5b9">Ejemplo Práctico</h3>
<div class="outline-text-3" id="text-orge11e5b9">
<p>
Supongamos que quieres identificar intentos de acceso al puerto 22 (SSH). Ejecuta:
</p>

<div class="org-src-container">
<pre class="src src-bash"><code>sudo grep <span style="color: #a44185;">"DPT=22"</span> /var/log/ufw.log &gt; ssh_attempts.log
</code></pre>
</div>

<p>
Luego, analiza los intentos por IP:
</p>

<div class="org-src-container">
<pre class="src src-bash"><code>awk <span style="color: #a44185;">'{print $13}'</span> ssh_attempts.log | sort | uniq -c
</code></pre>
</div>

<p>
Salida de ejemplo:
</p>

<div class="org-src-container">
<pre class="src src-text"><code> 5 SRC=192.168.1.100
10 SRC=203.0.113.50
</code></pre>
</div>

<p>
Esto indica que la IP `203.0.113.50` intentó acceder 10 veces al puerto 22.
</p>
</div>
</div>
</div>
<div id="outline-container-org1de198c" class="outline-2">
<h2 id="org1de198c">Resumen de Detalles Críticos</h2>
<div class="outline-text-2" id="text-org1de198c">
<p>
Los logs de UFW contienen información valiosa para la seguridad. Los detalles críticos a observar incluyen:
</p>
<ul class="org-ul">
<li><b><b>Acciones</b></b>: Bloqueos (`UFW BLOCK`) o permisos (`UFW ALLOW`).</li>
<li><b><b>Direcciones IP</b></b>: Identificar IPs sospechosas o repetitivas.</li>
<li><b><b>Puertos de destino</b></b>: Puertos comunes como 22 (SSH), 80 (HTTP) o 443 (HTTPS) son objetivos frecuentes.</li>
<li><b><b>Protocolos</b></b>: TCP, UDP, etc., para entender el tipo de tráfico.</li>
<li><b><b>Frecuencia</b></b>: Intentos repetidos pueden indicar un ataque.</li>
</ul>
</div>
</div>
<div id="outline-container-orgc09079d" class="outline-2">
<h2 id="orgc09079d">Tabla de Detalles Críticos en Formato `.org`</h2>
<div class="outline-text-2" id="text-orgc09079d">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Aspecto</th>
<th scope="col" class="org-left">Descripción</th>
<th scope="col" class="org-left">Comando de Ejemplo</th>
<th scope="col" class="org-left">Acción Recomendada</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Acción del Firewall</td>
<td class="org-left">Indica si el tráfico fue bloqueado o permitido</td>
<td class="org-left">`grep "UFW BLOCK" /var/log/ufw.log`</td>
<td class="org-left">Investigar bloqueos frecuentes</td>
</tr>

<tr>
<td class="org-left">IP de Origen (SRC)</td>
<td class="org-left">Dirección IP que envía el tráfico</td>
<td class="org-left">`awk '<i>UFW BLOCK</i> {print $13}' /var/log/ufw.log</td>
<td class="org-left">sort</td>
<td class="org-left">uniq`</td>
<td class="org-left">Bloquear IPs sospechosas con UFW</td>
</tr>

<tr>
<td class="org-left">Puerto de Destino (DPT)</td>
<td class="org-left">Puerto al que se dirige el tráfico</td>
<td class="org-left">`grep "DPT=22" /var/log/ufw.log`</td>
<td class="org-left">Monitorear puertos sensibles (22, 80, etc.)</td>
</tr>

<tr>
<td class="org-left">Protocolo</td>
<td class="org-left">Tipo de protocolo (TCP, UDP, etc.)</td>
<td class="org-left">`grep "PROTO=TCP" /var/log/ufw.log`</td>
<td class="org-left">Identificar protocolos inusuales</td>
</tr>

<tr>
<td class="org-left">Frecuencia</td>
<td class="org-left">Número de eventos por IP o puerto</td>
<td class="org-left">`grep "UFW BLOCK" /var/log/ufw.log</td>
<td class="org-left">wc -l`</td>
<td class="org-left">Configurar alertas para alta frecuencia</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orge4759f7" class="outline-2">
<h2 id="orge4759f7">Consejos para Emacs con Esteroides</h2>
<div class="outline-text-2" id="text-orge4759f7">
<p>
Si usas Emacs, puedes optimizar el análisis de logs:
</p>
<ul class="org-ul">
<li><b><b>Modo `org-mode`</b></b>: Copia la tabla anterior en un archivo `.org` para organizarla.</li>
<li><b><b>Modo `shell`</b></b>: Usa `M-x shell` para ejecutar comandos como `grep` o `awk` desde Emacs.</li>
<li><b><b>Dired</b></b>: Navega por `/var/log/` con `C-x C-f /var/log/ufw.log` y usa `dired-mode` para abrir logs.</li>
<li><b><b>Tramp</b></b>: Accede a logs en servidores remotos con `/ssh:user@host:/var/log/ufw.log`.</li>
</ul>
</div>
</div>
<div id="outline-container-orgb41186d" class="outline-2">
<h2 id="orgb41186d">Conclusión</h2>
<div class="outline-text-2" id="text-orgb41186d">
<p>
Analizar los logs de UFW te permite mantener tu sistema seguro y detectar problemas rápidamente. Con herramientas como `grep`, `awk` y Emacs, puedes filtrar, resumir y organizar la información de manera eficiente. Usa la tabla `.org` para mantener un registro claro de los detalles críticos y automatiza el monitoreo para ahorrar tiempo.
</p>

<div class="org-src-container">
<pre class="src src-bash"><code><span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Script para monitorear intentos al puerto 22 en tiempo real</span>
sudo tail -f /var/log/ufw.log | grep <span style="color: #a44185;">"DPT=22"</span>
</code></pre>
</div>
</div>
</div>
<div class="taglist"><a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tags.html">Categoría</a>: <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-ufw.html">ufw</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-firewall.html">firewall</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-logs.html">logs</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-sysadmin.html">sysadmin</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-ubuntu.html">ubuntu</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-emacs.html">emacs</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-org-mode.html">org-mode</a> </div>]]></description>
  <category><![CDATA[ufw]]></category>
  <category><![CDATA[firewall]]></category>
  <category><![CDATA[logs]]></category>
  <category><![CDATA[sysadmin]]></category>
  <category><![CDATA[ubuntu]]></category>
  <category><![CDATA[emacs]]></category>
  <category><![CDATA[org-mode]]></category>
  <link>https://mcasrom.github.io/Blogging-con-Emacs-y-AI/2025-05-30--an-lisis-del-log-del-firewall-ufw-en-ubuntu-gu-a-completa-para-usuarios.html</link>
  <guid>https://mcasrom.github.io/Blogging-con-Emacs-y-AI/2025-05-30--an-lisis-del-log-del-firewall-ufw-en-ubuntu-gu-a-completa-para-usuarios.html</guid>
  <pubDate>Fri, 30 May 2025 06:43:00 +0200</pubDate>
</item>
<item>
  <title><![CDATA[Guía Práctica: Configuración de UFW en Ubuntu con Scripts y Org Mode]]></title>
  <description><![CDATA[
<div id="outline-container-org43d23bd" class="outline-2">
<h2 id="org43d23bd">Introducción</h2>
<div class="outline-text-2" id="text-org43d23bd">
<p>
La seguridad es un aspecto crítico para cualquier servidor Linux. UFW (Uncomplicated Firewall) proporciona una interfaz simplificada para configurar un firewall robusto en sistemas Ubuntu. En este artículo, nos centraremos en la parte práctica: cómo crear, configurar y ejecutar un script de configuración de UFW, todo gestionado desde Emacs con Org Mode.
</p>

<p>
Este enfoque práctico te permitirá:
</p>
<ul class="org-ul">
<li>Documentar tu configuración de seguridad</li>
<li>Automatizar la implementación de reglas</li>
<li>Mantener un registro de los cambios realizados</li>
<li>Compartir fácilmente tu configuración con otros administradores</li>
</ul>

<p>
Está diseñado para administradores de sistemas y entusiastas de Linux que utilizan Emacs como parte de su flujo de trabajo.
</p>


<figure id="org668b759">
<img src="images/ufw-components.png" alt="ufw-components.png">

</figure>
</div>
</div>
<div id="outline-container-orga6af4d7" class="outline-2">
<h2 id="orga6af4d7">Prerrequisitos</h2>
<div class="outline-text-2" id="text-orga6af4d7">
<p>
Antes de comenzar, asegúrate de tener:
</p>

<ul class="org-ul">
<li>Ubuntu 22.04 LTS o superior</li>
<li>Emacs 27+ con Org Mode</li>
<li>Acceso root o privilegios sudo</li>
<li>UFW instalado (<code>sudo apt install ufw</code>)</li>
<li>Conexión SSH configurada (si trabajas remotamente)</li>
</ul>
</div>
</div>
<div id="outline-container-orgfe01919" class="outline-2">
<h2 id="orgfe01919">Creación del Script en Org Mode</h2>
<div class="outline-text-2" id="text-orgfe01919">
<p>
Comenzaremos creando un archivo Org Mode que contendrá nuestro script y documentación. En Emacs:
</p>

<ol class="org-ol">
<li>Crea un nuevo archivo: <code>C-x C-f ~/firewall-config.org RET</code></li>
<li>Añade la estructura básica del documento</li>
</ol>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #637c9d;">#+TITLE:</span> <span style="color: #dc3eb7; font-weight: bold;">Configuraci&#243;n de UFW para Servidores Ubuntu</span>
<span style="color: #637c9d;">#+AUTHOR:</span> <span style="color: #dc3eb7;">Tu Nombre</span>
<span style="color: #637c9d;">#+DATE:</span> <span style="color: #dc3eb7;">2025-04-15</span>
<span style="color: #60a8a1;">#+PROPERTY: header-args:bash :tangle ufw-secure-config.sh :comments both</span>

<span style="color: #2f86d2; font-weight: bold;">* Descripci&#243;n del Script</span>
Este script configura UFW en Ubuntu para proteger contra amenazas comunes,
incluyendo botnets, ataques de fuerza bruta y escaneos de puertos. Est&#225;
dise&#241;ado para servidores de producci&#243;n con exposici&#243;n a Internet.

<span style="color: #2f86d2; font-weight: bold;">* Script de Configuraci&#243;n</span>
<span style="color: #ffffff;">*</span><span style="color: #dc3eb7; font-weight: bold;">* Cabecera y verificaciones iniciales</span>
</pre>
</div>

<p>
El atributo <code>:tangle ufw-secure-config.sh</code> indica a Org Mode que extraiga (tangle) el código en un archivo ejecutable cuando lo solicitemos.
</p>
</div>
</div>
<div id="outline-container-org024ee21" class="outline-2">
<h2 id="org024ee21">Desarrollo del Script de Configuración UFW</h2>
<div class="outline-text-2" id="text-org024ee21">
<p>
Ahora desarrollaremos el script por secciones, añadiendo cada parte como un bloque de código Org Babel. Esto nos permite tener el script documentado y listo para ejecutar.
</p>
</div>
<div id="outline-container-org4e7dc53" class="outline-3">
<h3 id="org4e7dc53">Sección 1: Cabecera y verificaciones</h3>
<div class="outline-text-3" id="text-org4e7dc53">
<p>
Añade este bloque después de la sección "Cabecera y verificaciones iniciales":
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #8195b0; background-color: #9fafc4;">#+BEGIN_SRC bash</span>
<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">#</span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">!/bin/bash</span>
<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Script: ufw-secure-config.sh</span>
<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Descripci&#243;n: Configuraci&#243;n segura de UFW para servidores Ubuntu</span>
<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Autor: Tu Nombre</span>
<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Fecha: 2025-04-15</span>
<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Versi&#243;n: 1.0</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Colores para mejor legibilidad</span>
<span style="color: #1857a4; background-color: #9fafc4;">RED</span><span style="background-color: #9fafc4;">=</span><span style="color: #a44185; background-color: #9fafc4;">'\033[0;31m'</span>
<span style="color: #1857a4; background-color: #9fafc4;">GREEN</span><span style="background-color: #9fafc4;">=</span><span style="color: #a44185; background-color: #9fafc4;">'\033[0;32m'</span>
<span style="color: #1857a4; background-color: #9fafc4;">YELLOW</span><span style="background-color: #9fafc4;">=</span><span style="color: #a44185; background-color: #9fafc4;">'\033[1;33m'</span>
<span style="color: #1857a4; background-color: #9fafc4;">NC</span><span style="background-color: #9fafc4;">=</span><span style="color: #a44185; background-color: #9fafc4;">'\033[0m'</span><span style="background-color: #9fafc4;"> </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Sin Color</span>

<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"${GREEN}=== Script de Configuraci&#243;n Segura de UFW ===${NC}"</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"Iniciando configuraci&#243;n en $(</span><span style="color: #219fd5; background-color: #9fafc4; font-weight: bold;">date</span><span style="color: #a44185; background-color: #9fafc4;">)"</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Verificar privilegios de root</span>
<span style="color: #219fd5; background-color: #9fafc4; font-style: italic;">if</span><span style="background-color: #9fafc4;"> <a href=" $EUID -ne 0 ">[[ $</a></span><span style="color: #1857a4; background-color: #9fafc4;"><a href=" $EUID -ne 0 ">EUID</a></span><span style="background-color: #9fafc4;"><a href=" $EUID -ne 0 "> -ne 0 ]]</a>; </span><span style="color: #219fd5; background-color: #9fafc4; font-style: italic;">then</span>
<span style="background-color: #9fafc4;">    </span><span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"${RED}Este script requiere privilegios de root.${NC}"</span>
<span style="background-color: #9fafc4;">    </span><span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"Por favor, ejecuta con sudo: sudo bash $0"</span>
<span style="background-color: #9fafc4;">    </span><span style="color: #219fd5; background-color: #9fafc4; font-style: italic;">exit</span><span style="background-color: #9fafc4;"> 1</span>
<span style="color: #219fd5; background-color: #9fafc4; font-style: italic;">fi</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Verificar que UFW est&#233; instalado</span>
<span style="color: #219fd5; background-color: #9fafc4; font-style: italic;">if ! </span><span style="color: #dc3eb7; background-color: #9fafc4;">command</span><span style="background-color: #9fafc4;"> -v ufw &amp;&gt; /dev/null; </span><span style="color: #219fd5; background-color: #9fafc4; font-style: italic;">then</span>
<span style="background-color: #9fafc4;">    </span><span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"${YELLOW}UFW no est&#225; instalado. Instalando...${NC}"</span>
<span style="background-color: #9fafc4;">    apt update &amp;&amp; apt install -y ufw</span>
<span style="background-color: #9fafc4;">    </span><span style="color: #219fd5; background-color: #9fafc4; font-style: italic;">if</span><span style="background-color: #9fafc4;"> [ $</span><span style="color: #1857a4; background-color: #9fafc4;">?</span><span style="background-color: #9fafc4;"> -ne 0 ]; </span><span style="color: #219fd5; background-color: #9fafc4; font-style: italic;">then</span>
<span style="background-color: #9fafc4;">        </span><span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"${RED}Error instalando UFW. Abortando.${NC}"</span>
<span style="background-color: #9fafc4;">        </span><span style="color: #219fd5; background-color: #9fafc4; font-style: italic;">exit</span><span style="background-color: #9fafc4;"> 1</span>
<span style="background-color: #9fafc4;">    </span><span style="color: #219fd5; background-color: #9fafc4; font-style: italic;">fi</span>
<span style="background-color: #9fafc4;">    </span><span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"${GREEN}UFW instalado correctamente.${NC}"</span>
<span style="color: #219fd5; background-color: #9fafc4; font-style: italic;">else</span>
<span style="background-color: #9fafc4;">    </span><span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"${GREEN}UFW ya est&#225; instalado.${NC}"</span>
<span style="color: #219fd5; background-color: #9fafc4; font-style: italic;">fi</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Crear directorio para backups si no existe</span>
<span style="color: #1857a4; background-color: #9fafc4;">BACKUP_DIR</span><span style="background-color: #9fafc4;">=</span><span style="color: #a44185; background-color: #9fafc4;">"/root/ufw-backups"</span>
<span style="color: #219fd5; background-color: #9fafc4; font-style: italic;">if</span><span style="background-color: #9fafc4;"> [ </span><span style="color: #219fd5; background-color: #9fafc4; font-weight: bold;">!</span><span style="background-color: #9fafc4;"> -d </span><span style="color: #a44185; background-color: #9fafc4;">"$BACKUP_DIR"</span><span style="background-color: #9fafc4;"> ]; </span><span style="color: #219fd5; background-color: #9fafc4; font-style: italic;">then</span>
<span style="background-color: #9fafc4;">    mkdir -p </span><span style="color: #a44185; background-color: #9fafc4;">"$BACKUP_DIR"</span>
<span style="background-color: #9fafc4;">    </span><span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"Directorio para backups creado: $BACKUP_DIR"</span>
<span style="color: #219fd5; background-color: #9fafc4; font-style: italic;">fi</span>
<span style="color: #8195b0; background-color: #9fafc4;">#+END_SRC</span>

<span style="color: #ffffff;">*</span><span style="color: #dc3eb7; font-weight: bold;">* Secci&#243;n 2: Backup y reinicio de configuraci&#243;n</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf5da726" class="outline-3">
<h3 id="orgf5da726">Sección 2: Backup y reinicio de configuración</h3>
<div class="outline-text-3" id="text-orgf5da726">
<p>
Continuamos con la siguiente sección:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #8195b0; background-color: #9fafc4;">#+BEGIN_SRC bash</span>
<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Crear backup de reglas actuales</span>
<span style="color: #1857a4; background-color: #9fafc4;">TIMESTAMP</span><span style="background-color: #9fafc4;">=$(</span><span style="color: #219fd5; background-color: #9fafc4; font-weight: bold;">date +%F-%H%M%S</span><span style="background-color: #9fafc4;">)</span>
<span style="color: #1857a4; background-color: #9fafc4;">BACKUP_FILE</span><span style="background-color: #9fafc4;">=</span><span style="color: #a44185; background-color: #9fafc4;">"$BACKUP_DIR/ufw-backup-$TIMESTAMP.rules"</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"${YELLOW}Creando backup de reglas actuales en:${NC} $BACKUP_FILE"</span>
<span style="background-color: #9fafc4;">ufw status verbose &gt; </span><span style="color: #a44185; background-color: #9fafc4;">"$BACKUP_FILE"</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Guardar configuraci&#243;n actual de iptables para referencia</span>
<span style="background-color: #9fafc4;">iptables-save &gt; </span><span style="color: #a44185; background-color: #9fafc4;">"$BACKUP_DIR/iptables-backup-$TIMESTAMP.rules"</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"Backup de iptables guardado en: $BACKUP_DIR/iptables-backup-$TIMESTAMP.rules"</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Reiniciar UFW para configuraci&#243;n limpia</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"${YELLOW}Reiniciando UFW para iniciar configuraci&#243;n limpia...${NC}"</span>
<span style="background-color: #9fafc4;">ufw --force reset</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"${GREEN}UFW reiniciado correctamente.${NC}"</span>
<span style="color: #8195b0; background-color: #9fafc4;">#+END_SRC</span>

<span style="color: #ffffff;">*</span><span style="color: #dc3eb7; font-weight: bold;">* Secci&#243;n 3: Configuraci&#243;n de pol&#237;ticas b&#225;sicas</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orga3e5d1f" class="outline-3">
<h3 id="orga3e5d1f">Sección 3: Configuración de políticas básicas</h3>
<div class="outline-text-3" id="text-orga3e5d1f">
<p>
Configuramos las políticas predeterminadas y activamos el logging:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #8195b0; background-color: #9fafc4;">#+BEGIN_SRC bash</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"\n${GREEN}=== Configurando pol&#237;ticas b&#225;sicas ===${NC}"</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Establecer pol&#237;ticas predeterminadas</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"Configurando pol&#237;tica por defecto: denegar tr&#225;fico entrante"</span>
<span style="background-color: #9fafc4;">ufw default deny incoming</span>

<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"Configurando pol&#237;tica por defecto: permitir tr&#225;fico saliente"</span>
<span style="background-color: #9fafc4;">ufw default allow outgoing</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Configurar nivel de log</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"Configurando nivel de logging: medio"</span>
<span style="background-color: #9fafc4;">ufw logging medium</span>

<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"${GREEN}Pol&#237;ticas b&#225;sicas configuradas correctamente.${NC}"</span>
<span style="color: #8195b0; background-color: #9fafc4;">#+END_SRC</span>

<span style="color: #ffffff;">*</span><span style="color: #dc3eb7; font-weight: bold;">* Secci&#243;n 4: Reglas para servicios esenciales</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org5c217f6" class="outline-3">
<h3 id="org5c217f6">Sección 4: Reglas para servicios esenciales</h3>
<div class="outline-text-3" id="text-org5c217f6">
<p>
Configuramos las reglas para los servicios principales:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #8195b0; background-color: #9fafc4;">#+BEGIN_SRC bash</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"\n${GREEN}=== Configurando reglas para servicios esenciales ===${NC}"</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">SSH - Limitar intentos para prevenir ataques de fuerza bruta</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"Configurando SSH con l&#237;mite de conexiones..."</span>
<span style="background-color: #9fafc4;">ufw limit proto tcp from any to any port 22 comment </span><span style="color: #a44185; background-color: #9fafc4;">'SSH con l&#237;mite de conexiones'</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">HTTP/HTTPS para servidores web</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"Configurando acceso web (HTTP/HTTPS)..."</span>
<span style="background-color: #9fafc4;">ufw allow proto tcp from any to any port 80 comment </span><span style="color: #a44185; background-color: #9fafc4;">'HTTP'</span>
<span style="background-color: #9fafc4;">ufw allow proto tcp from any to any port 443 comment </span><span style="color: #a44185; background-color: #9fafc4;">'HTTPS'</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">DNS para resoluci&#243;n de nombres</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"Configurando acceso DNS..."</span>
<span style="background-color: #9fafc4;">ufw allow proto udp from any to any port 53 comment </span><span style="color: #a44185; background-color: #9fafc4;">'DNS'</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">NTP para sincronizaci&#243;n horaria</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"Configurando acceso NTP..."</span>
<span style="background-color: #9fafc4;">ufw allow proto udp from any to any port 123 comment </span><span style="color: #a44185; background-color: #9fafc4;">'NTP'</span>

<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"${GREEN}Servicios esenciales configurados.${NC}"</span>
<span style="color: #8195b0; background-color: #9fafc4;">#+END_SRC</span>

<span style="color: #ffffff;">*</span><span style="color: #dc3eb7; font-weight: bold;">* Secci&#243;n 5: Protecci&#243;n contra amenazas comunes</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb425bf5" class="outline-3">
<h3 id="orgb425bf5">Sección 5: Protección contra amenazas comunes</h3>
<div class="outline-text-3" id="text-orgb425bf5">
<p>
Añadimos reglas para mitigar amenazas específicas:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #8195b0; background-color: #9fafc4;">#+BEGIN_SRC bash</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"\n${GREEN}=== Configurando protecci&#243;n contra amenazas espec&#237;ficas ===${NC}"</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Limitar intentos de conexi&#243;n para HTTP/HTTPS (protecci&#243;n b&#225;sica contra DDoS)</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"Configurando l&#237;mites de conexi&#243;n para servicios web..."</span>
<span style="background-color: #9fafc4;">ufw limit proto tcp from any to any port 80 comment </span><span style="color: #a44185; background-color: #9fafc4;">'Limitar HTTP'</span>
<span style="background-color: #9fafc4;">ufw limit proto tcp from any to any port 443 comment </span><span style="color: #a44185; background-color: #9fafc4;">'Limitar HTTPS'</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Bloquear puertos com&#250;nmente explotados por botnets y malware</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"Bloqueando puertos vulnerables com&#250;nmente usados por botnets..."</span>
<span style="background-color: #9fafc4;">ufw deny proto tcp from any to any port 23 comment </span><span style="color: #a44185; background-color: #9fafc4;">'Telnet, usado por botnets'</span>
<span style="background-color: #9fafc4;">ufw deny proto tcp from any to any port 445 comment </span><span style="color: #a44185; background-color: #9fafc4;">'SMB, objetivo de ransomware'</span>
<span style="background-color: #9fafc4;">ufw deny proto tcp from any to any port 1433 comment </span><span style="color: #a44185; background-color: #9fafc4;">'MS-SQL, explotado por botnets'</span>
<span style="background-color: #9fafc4;">ufw deny proto tcp from any to any port 3389 comment </span><span style="color: #a44185; background-color: #9fafc4;">'RDP, objetivo com&#250;n'</span>
<span style="background-color: #9fafc4;">ufw deny proto udp from any to any port 1900 comment </span><span style="color: #a44185; background-color: #9fafc4;">'UPnP, usado en DDoS'</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Bloquear rangos de puertos ef&#237;meros sospechosos</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"Bloqueando rangos de puertos sospechosos..."</span>
<span style="background-color: #9fafc4;">ufw deny proto tcp from any to any port 49152:65535 comment </span><span style="color: #a44185; background-color: #9fafc4;">'Puertos ef&#237;meros sospechosos'</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Limitar ICMP para prevenir ataques de flood</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"Limitando tr&#225;fico ICMP..."</span>
<span style="background-color: #9fafc4;">ufw limit proto icmp from any to any comment </span><span style="color: #a44185; background-color: #9fafc4;">'Limitar ping'</span>

<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"${GREEN}Protecci&#243;n contra amenazas comunes configurada.${NC}"</span>
<span style="color: #8195b0; background-color: #9fafc4;">#+END_SRC</span>

<span style="color: #ffffff;">*</span><span style="color: #dc3eb7; font-weight: bold;">* Secci&#243;n 6: Bloqueo de IPs maliciosas</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org225637b" class="outline-3">
<h3 id="org225637b">Sección 6: Bloqueo de IPs maliciosas</h3>
<div class="outline-text-3" id="text-org225637b">
<p>
Bloqueamos rangos de IPs conocidos por actividades maliciosas:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #8195b0; background-color: #9fafc4;">#+BEGIN_SRC bash</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"\n${GREEN}=== Configurando bloqueo de IPs maliciosas ===${NC}"</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Nota: Estas son IPs de ejemplo. En producci&#243;n, usa listas actualizadas.</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"Bloqueando rangos de IPs conocidos por actividades maliciosas..."</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Ejemplos de rangos sospechosos (reemplazar con datos actualizados en producci&#243;n)</span>
<span style="background-color: #9fafc4;">ufw deny from 185.220.101.0/24 comment </span><span style="color: #a44185; background-color: #9fafc4;">'Rango de IPs sospechosas - Tor exit nodes'</span>
<span style="background-color: #9fafc4;">ufw deny from 45.148.10.0/24 comment </span><span style="color: #a44185; background-color: #9fafc4;">'Rango de IPs de botnets reportadas'</span>
<span style="background-color: #9fafc4;">ufw deny from 91.134.0.0/16 comment </span><span style="color: #a44185; background-color: #9fafc4;">'Fuente conocida de ataques'</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Opci&#243;n: Descomentar y modificar para actualizar desde fuente externa</span>
<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">echo "Descargando lista actualizada de IPs maliciosas..."</span>
<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">curl -s <a href="https://ejemplo.com/ip-blocklist.txt">https://ejemplo.com/ip-blocklist.txt</a> | while read ip; do</span>
<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">#   </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">ufw deny from $ip comment 'IP maliciosa - lista externa'</span>
<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">done</span>

<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"${YELLOW}Nota: Considera actualizar regularmente la lista de IPs bloqueadas.${NC}"</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"${GREEN}Bloqueo de IPs maliciosas configurado.${NC}"</span>
<span style="color: #8195b0; background-color: #9fafc4;">#+END_SRC</span>

<span style="color: #ffffff;">*</span><span style="color: #dc3eb7; font-weight: bold;">* Secci&#243;n 7: Activaci&#243;n del firewall</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orga27208d" class="outline-3">
<h3 id="orga27208d">Sección 7: Activación del firewall</h3>
<div class="outline-text-3" id="text-orga27208d">
<p>
Finalmente, activamos el firewall y mostramos el estado:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #8195b0; background-color: #9fafc4;">#+BEGIN_SRC bash</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"\n${GREEN}=== Activando UFW ===${NC}"</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Habilitar UFW</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"Activando firewall..."</span>
<span style="background-color: #9fafc4;">ufw --force enable</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Verificar estado</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"\n${GREEN}=== Estado final de UFW ===${NC}"</span>
<span style="background-color: #9fafc4;">ufw status verbose</span>

<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"\n${GREEN}=== Configuraci&#243;n completada exitosamente ===${NC}"</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"Fecha y hora: $(</span><span style="color: #219fd5; background-color: #9fafc4; font-weight: bold;">date</span><span style="color: #a44185; background-color: #9fafc4;">)"</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> -e </span><span style="color: #a44185; background-color: #9fafc4;">"${YELLOW}Recomendaciones:${NC}"</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"1. Revisa peri&#243;dicamente /var/log/ufw.log para detectar actividad sospechosa"</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"2. Considera implementar Fail2Ban como protecci&#243;n adicional"</span>
<span style="color: #dc3eb7; background-color: #9fafc4;">echo</span><span style="background-color: #9fafc4;"> </span><span style="color: #a44185; background-color: #9fafc4;">"3. Actualiza las reglas regularmente seg&#250;n evolucionen las amenazas"</span>

<span style="color: #219fd5; background-color: #9fafc4; font-style: italic;">exit</span><span style="background-color: #9fafc4;"> 0</span>
<span style="color: #8195b0; background-color: #9fafc4;">#+END_SRC</span>

<span style="color: #2f86d2; font-weight: bold;">* Utilizaci&#243;n del Script</span>
<span style="color: #ffffff;">*</span><span style="color: #dc3eb7; font-weight: bold;">* Generaci&#243;n del script ejecutable</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orga45b6f8" class="outline-2">
<h2 id="orga45b6f8">Utilización del Script desde Org Mode</h2>
<div class="outline-text-2" id="text-orga45b6f8">
<p>
Ahora que tenemos nuestro script documentado en Org Mode, vamos a ver cómo utilizarlo.
</p>
</div>
<div id="outline-container-org8121919" class="outline-3">
<h3 id="org8121919">Generación del script ejecutable</h3>
<div class="outline-text-3" id="text-org8121919">
<p>
Para generar el archivo ejecutable a partir de nuestro documento Org:
</p>

<div class="org-src-container">
<pre class="src src-org">Para extraer (tangle) el script desde este documento Org Mode:

1. Posiciona el cursor en cualquier parte del documento
2. Ejecuta: <span style="color: #fa841d; background-color: #9fafc4;">~M-x org-babel-tangle~</span> (o usa el atajo <span style="color: #fa841d; background-color: #9fafc4;">~C-c C-v t~</span>)
3. Esto crear&#225; el archivo <span style="color: #fa841d; background-color: #9fafc4;">~ufw-secure-config.sh~</span> en el mismo directorio

Alternativamente, puedes ejecutar esto directamente como un bloque de c&#243;digo:

<span style="color: #8195b0; background-color: #9fafc4;">#+BEGIN_SRC emacs-lisp :results silent</span>
<span style="background-color: #9fafc4;">(org-babel-tangle)</span>
<span style="color: #8195b0; background-color: #9fafc4;">#+END_SRC</span>

Una vez extra&#237;do, hazlo ejecutable:

<span style="color: #8195b0; background-color: #9fafc4;">#+BEGIN_SRC bash :dir .</span>
<span style="background-color: #9fafc4;">chmod +x ufw-secure-config.sh</span>
<span style="background-color: #9fafc4;">ls -la ufw-secure-config.sh</span>
<span style="color: #8195b0; background-color: #9fafc4;">#+END_SRC</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orga05a8fa" class="outline-3">
<h3 id="orga05a8fa">Ejecución del script</h3>
<div class="outline-text-3" id="text-orga05a8fa">
<p>
Añade esta sección para documentar la ejecución:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #ffffff;">*</span><span style="color: #dc3eb7; font-weight: bold;">* Ejecuci&#243;n del script</span>

El script debe ejecutarse con privilegios de superusuario:

<span style="color: #8195b0; background-color: #9fafc4;">#+BEGIN_SRC bash :dir . :results output :eval no</span>
<span style="background-color: #9fafc4;">sudo ./ufw-secure-config.sh</span>
<span style="color: #8195b0; background-color: #9fafc4;">#+END_SRC</span>

Nota: El script realizar&#225; las siguientes acciones:
1. Verificar&#225; los privilegios y la instalaci&#243;n de UFW
2. Crear&#225; un backup de las reglas existentes
3. Reiniciar&#225; la configuraci&#243;n de UFW
4. Establecer&#225; pol&#237;ticas predeterminadas seguras
5. Configurar&#225; reglas para servicios esenciales
6. Implementar&#225; protecciones contra amenazas comunes
7. Bloquear&#225; IPs maliciosas conocidas
8. Activar&#225; el firewall con la nueva configuraci&#243;n

<span style="color: #2f86d2; font-weight: bold;">* Personalizaci&#243;n del Script</span>

Puedes personalizar este script para adaptarlo a tus necesidades espec&#237;ficas:

<span style="color: #ffffff;">*</span><span style="color: #dc3eb7; font-weight: bold;">* Servicios adicionales</span>

Para a&#241;adir reglas para otros servicios, agrega l&#237;neas como estas en la Secci&#243;n 4:

<span style="color: #8195b0; background-color: #9fafc4;">#+BEGIN_SRC bash :eval no</span>
<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">FTP (si es necesario)</span>
<span style="background-color: #9fafc4;">ufw allow proto tcp from any to any port 21 comment </span><span style="color: #a44185; background-color: #9fafc4;">'FTP'</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Correo electr&#243;nico</span>
<span style="background-color: #9fafc4;">ufw allow proto tcp from any to any port 25,465,587 comment </span><span style="color: #a44185; background-color: #9fafc4;">'SMTP'</span>
<span style="background-color: #9fafc4;">ufw allow proto tcp from any to any port 110,995 comment </span><span style="color: #a44185; background-color: #9fafc4;">'POP3'</span>
<span style="background-color: #9fafc4;">ufw allow proto tcp from any to any port 143,993 comment </span><span style="color: #a44185; background-color: #9fafc4;">'IMAP'</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Base de datos (solo desde redes confiables)</span>
<span style="background-color: #9fafc4;">ufw allow proto tcp from 192.168.1.0/24 to any port 3306 comment </span><span style="color: #a44185; background-color: #9fafc4;">'MySQL desde LAN'</span>
<span style="color: #8195b0; background-color: #9fafc4;">#+END_SRC</span>

<span style="color: #ffffff;">*</span><span style="color: #dc3eb7; font-weight: bold;">* Restricci&#243;n por origen</span>

Para permitir servicios solo desde ciertas IPs o redes:

<span style="color: #8195b0; background-color: #9fafc4;">#+BEGIN_SRC bash :eval no</span>
<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Acceso SSH solo desde oficina</span>
<span style="background-color: #9fafc4;">ufw allow proto tcp from 203.0.113.0/24 to any port 22 comment </span><span style="color: #a44185; background-color: #9fafc4;">'SSH desde oficina'</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Panel de administraci&#243;n solo desde IPs espec&#237;ficas</span>
<span style="background-color: #9fafc4;">ufw allow proto tcp from 203.0.113.10 to any port 8080 comment </span><span style="color: #a44185; background-color: #9fafc4;">'Admin desde IP confiable'</span>
<span style="color: #8195b0; background-color: #9fafc4;">#+END_SRC</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org8a9e92b" class="outline-2">
<h2 id="org8a9e92b">Monitoreo y Mantenimiento</h2>
<div class="outline-text-2" id="text-org8a9e92b">
<p>
Añade esta sección para completar el post:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #2f86d2; font-weight: bold;">* Monitoreo y Mantenimiento</span>

Una vez configurado el firewall, es importante monitorizarlo y mantenerlo:

<span style="color: #ffffff;">*</span><span style="color: #dc3eb7; font-weight: bold;">* Verificaci&#243;n del estado</span>

Para verificar el estado actual del firewall:

<span style="color: #8195b0; background-color: #9fafc4;">#+BEGIN_SRC bash :eval no</span>
<span style="background-color: #9fafc4;">sudo ufw status verbose</span>
<span style="color: #8195b0; background-color: #9fafc4;">#+END_SRC</span>

<span style="color: #ffffff;">*</span><span style="color: #dc3eb7; font-weight: bold;">* Monitoreo de logs</span>

Para monitorizar actividad sospechosa:

<span style="color: #8195b0; background-color: #9fafc4;">#+BEGIN_SRC bash :eval no</span>
<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Ver &#250;ltimas entradas del log en tiempo real</span>
<span style="background-color: #9fafc4;">sudo tail -f /var/log/ufw.log</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Buscar intentos de conexi&#243;n bloqueados</span>
<span style="background-color: #9fafc4;">sudo grep </span><span style="color: #a44185; background-color: #9fafc4;">"BLOCK"</span><span style="background-color: #9fafc4;"> /var/log/ufw.log</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Contar intentos bloqueados por IP (TOP 10)</span>
<span style="background-color: #9fafc4;">sudo grep </span><span style="color: #a44185; background-color: #9fafc4;">"BLOCK"</span><span style="background-color: #9fafc4;"> /var/log/ufw.log | grep -oE </span><span style="color: #a44185; background-color: #9fafc4;">"SRC=[0-9.]+"</span><span style="background-color: #9fafc4;"> | sort | uniq -c | sort -nr | head -10</span>
<span style="color: #8195b0; background-color: #9fafc4;">#+END_SRC</span>

<span style="color: #ffffff;">*</span><span style="color: #dc3eb7; font-weight: bold;">* Actualizaci&#243;n de reglas</span>

Cuando necesites actualizar las reglas:

<span style="color: #8195b0; background-color: #9fafc4;">#+BEGIN_SRC bash :eval no</span>
<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Ver reglas numeradas</span>
<span style="background-color: #9fafc4;">sudo ufw status numbered</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Eliminar una regla espec&#237;fica</span>
<span style="background-color: #9fafc4;">sudo ufw delete 3  </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Elimina la regla n&#250;mero 3</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">A&#241;adir una nueva regla</span>
<span style="background-color: #9fafc4;">sudo ufw allow proto tcp from any to any port 8443 comment </span><span style="color: #a44185; background-color: #9fafc4;">'HTTPS alternativo'</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Aplicar cambios</span>
<span style="background-color: #9fafc4;">sudo ufw reload</span>
<span style="color: #8195b0; background-color: #9fafc4;">#+END_SRC</span>

<span style="color: #2f86d2; font-weight: bold;">* Integraci&#243;n con cron para Actualizaciones Autom&#225;ticas</span>

Para mantener tu lista de IPs bloqueadas actualizada, puedes crear un script separado y programarlo con cron:

<span style="color: #8195b0; background-color: #9fafc4;">#+BEGIN_SRC org</span>
<span style="background-color: #9fafc4;">#+BEGIN_SRC bash :tangle update-blocklist.sh :comments both</span>
<span style="background-color: #9fafc4;">#!/bin/bash</span>
<span style="background-color: #9fafc4;"># Script: update-blocklist.sh</span>
<span style="background-color: #9fafc4;"># Descripci&#243;n: Actualiza la lista de IPs bloqueadas en UFW</span>
<span style="background-color: #9fafc4;"># Autor: Tu Nombre</span>
<span style="background-color: #9fafc4;"># Fecha: 2025-04-15</span>

<span style="background-color: #9fafc4;"># Verificar privilegios</span>
<span style="background-color: #9fafc4;">if </span><span style="color: #2f86d2; background-color: #9fafc4; font-weight: bold; text-decoration: underline;"><a href=" $EUID -ne 0 ">[[ $EUID -ne 0 ]]</a></span><span style="background-color: #9fafc4;">; then</span>
<span style="background-color: #9fafc4;">    echo "Este script requiere privilegios de root."</span>
<span style="background-color: #9fafc4;">    exit 1</span>
<span style="background-color: #9fafc4;">fi</span>

<span style="background-color: #9fafc4;"># Directorio para logs</span>
<span style="background-color: #9fafc4;">LOG_DIR="/var/log/ufw-updates"</span>
<span style="background-color: #9fafc4;">mkdir -p "$LOG_DIR"</span>
<span style="background-color: #9fafc4;">LOG_FILE="$LOG_DIR/update-$(date +%F).log"</span>

<span style="background-color: #9fafc4;">echo "Iniciando actualizaci&#243;n de listas de bloqueo en $(date)" &gt;&gt; "$LOG_FILE"</span>

<span style="background-color: #9fafc4;"># Descargar lista actualizada (ejemplo)</span>
<span style="background-color: #9fafc4;">echo "Descargando lista actualizada..." &gt;&gt; "$LOG_FILE"</span>
<span style="background-color: #9fafc4;">curl -s </span><span style="color: #2f86d2; background-color: #9fafc4; font-weight: bold; text-decoration: underline;"><a href="https://ejemplo.com/ip-blocklist.txt">https://ejemplo.com/ip-blocklist.txt</a></span><span style="background-color: #9fafc4;"> &gt; /tmp/new-blocklist.txt</span>

<span style="background-color: #9fafc4;"># Eliminar reglas antiguas con comentario espec&#237;fico</span>
<span style="background-color: #9fafc4;">echo "Eliminando reglas antiguas..." &gt;&gt; "$LOG_FILE"</span>
<span style="background-color: #9fafc4;">for ip in $(ufw status | grep "lista externa" | awk '{print $3}'); do</span>
<span style="background-color: #9fafc4;">  ufw delete deny from $ip &gt;&gt; "$LOG_FILE" 2&gt;&amp;1</span>
<span style="background-color: #9fafc4;">done</span>

<span style="background-color: #9fafc4;"># A&#241;adir nuevas IPs</span>
<span style="background-color: #9fafc4;">echo "A&#241;adiendo nuevas IPs..." &gt;&gt; "$LOG_FILE"</span>
<span style="background-color: #9fafc4;">count=0</span>
<span style="background-color: #9fafc4;">while read ip; do</span>
<span style="background-color: #9fafc4;">  if [[ $ip =~ ^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}(/[0-9]{1,2})?$ ]]; then</span>
<span style="background-color: #9fafc4;">    ufw deny from $ip comment 'IP maliciosa - lista externa' &gt;&gt; "$LOG_FILE" 2&gt;&amp;1</span>
<span style="background-color: #9fafc4;">    ((count++))</span>
<span style="background-color: #9fafc4;">  fi</span>
<span style="background-color: #9fafc4;">done &lt; /tmp/new-blocklist.txt</span>

<span style="background-color: #9fafc4;">echo "Actualizaci&#243;n completada. $count IPs bloqueadas." &gt;&gt; "$LOG_FILE"</span>
<span style="background-color: #9fafc4;">echo "Fecha y hora de finalizaci&#243;n: $(date)" &gt;&gt; "$LOG_FILE"</span>

<span style="background-color: #9fafc4;"># Limpiar archivos temporales</span>
<span style="background-color: #9fafc4;">rm /tmp/new-blocklist.txt</span>

<span style="background-color: #9fafc4;">exit 0</span>
<span style="color: #8195b0; background-color: #9fafc4;">#+END_SRC</span>
<span style="color: #60a8a1;">#+END_SRC</span>

Programa la ejecuci&#243;n con cron:

<span style="color: #8195b0; background-color: #9fafc4;">#+BEGIN_SRC bash :eval no</span>
<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">Editar crontab</span>
<span style="background-color: #9fafc4;">sudo crontab -e</span>

<span style="color: #8195b0; background-color: #9fafc4; font-style: italic;"># </span><span style="color: #8195b0; background-color: #9fafc4; font-style: italic;">A&#241;adir l&#237;nea para ejecutar cada d&#237;a a las 3 AM</span>
<span style="background-color: #9fafc4;">0 3 * * * /ruta/a/update-blocklist.sh</span>
<span style="color: #8195b0; background-color: #9fafc4;">#+END_SRC</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdfe2fe9" class="outline-2">
<h2 id="orgdfe2fe9">Conclusión y Recursos Adicionales</h2>
<div class="outline-text-2" id="text-orgdfe2fe9">
<p>
Finalmente, añade una conclusión y recursos adicionales:
</p>

<p>
#+BEGIN<sub>SRC</sub> org
,* Conclusión
</p>

<p>
Configurar UFW a través de scripts gestionados con Org Mode en Emacs ofrece varias ventajas:
</p>

<ol class="org-ol">
<li><b>Documentación integrada</b>: El código y su explicación se mantienen juntos</li>
<li><b>Reproducibilidad</b>: Puedes recrear exactamente la misma configuración en diferentes servidores</li>
<li><b>Control de versiones</b>: Puedes mantener tu configuración en un sistema de control de versiones como Git</li>
<li><b>Adaptabilidad</b>: Fácil de modificar para diferentes entornos (desarrollo, pruebas, producción)</li>
</ol>

<p>
Esta aproximación combina la potencia de Emacs y Org Mode con las necesidades prácticas de la administración de sistemas, creando un flujo de trabajo eficiente y bien documentado para la gestión de la seguridad.
</p>

<p>
Recuerda que la seguridad es un proceso continuo, no un estado final. Mantén tus reglas de firewall actualizadas, revisa regularmente los logs y adapta tu configuración según evolucionen las amenazas.
</p>

<p>
,* Recursos Adicionales
</p>

<ul class="org-ul">
<li><a href="https://help.ubuntu.com/community/UFW">Documentación oficial de UFW en Ubuntu</a></li>
<li><a href="https://wiki.archlinux.org/title/Uncomplicated_Firewall">Wiki de Arch Linux sobre UFW</a></li>
<li><a href="https://orgmode.org/worg/org-contrib/babel/">Documentación de Org Babel</a></li>
<li><a href="https://www.abuseipdb.com/">AbuseIPDB</a> - Base de datos de IPs maliciosas</li>
</ul>

<p>
,* Notas de la versión
</p>

<ul class="org-ul">
<li><b>Versión 1.0 (2025-04-15)</b>: Publicación inicial</li>
<li><b>Próximas mejoras planificadas</b>: Integración con Fail2Ban, reglas para Docker, configuración para IPv6</li>
</ul>
</div>
</div>
<div id="outline-container-org602bbf5" class="outline-2">
<h2 id="org602bbf5">Diagrama de Componentes de la Configuración</h2>
<div class="outline-text-2" id="text-org602bbf5">
<p>
Este diagrama muestra los componentes principales que conforman la configuración de seguridad con UFW:
</p>


<figure id="orgb3074ff">
<img src="images/ufw-components.png" alt="ufw-components.png">

</figure>
</div>
</div>
<div class="taglist"><a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tags.html">Categoría</a>: <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-linux.html">linux</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-ubuntu.html">ubuntu</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-seguridad.html">seguridad</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-firewall.html">firewall</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-ufw.html">ufw</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-emacs.html">emacs</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-orgmode.html">orgmode</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-tutoriales.html">tutoriales</a> </div>]]></description>
  <category><![CDATA[linux]]></category>
  <category><![CDATA[ubuntu]]></category>
  <category><![CDATA[seguridad]]></category>
  <category><![CDATA[firewall]]></category>
  <category><![CDATA[ufw]]></category>
  <category><![CDATA[emacs]]></category>
  <category><![CDATA[orgmode]]></category>
  <category><![CDATA[tutoriales]]></category>
  <link>https://mcasrom.github.io/Blogging-con-Emacs-y-AI/2025-04-15-gu-a-pr-ctica-configuraci-n-de-ufw-en-ubuntu-con-scripts-y-org-mode.html</link>
  <guid>https://mcasrom.github.io/Blogging-con-Emacs-y-AI/2025-04-15-gu-a-pr-ctica-configuraci-n-de-ufw-en-ubuntu-con-scripts-y-org-mode.html</guid>
  <pubDate>Tue, 15 Apr 2025 23:09:00 +0200</pubDate>
</item>
</channel>
</rss>
