<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
<title><![CDATA[Emacs con esteroides - nort]]></title>
<description><![CDATA[Emacs con esteroides - nort]]></description>
<link>https://mcasrom.github.io/Blogging-con-Emacs-y-AI//tag-nort.html</link>
<lastBuildDate>Sat, 10 May 2025 03:25:06 +0200</lastBuildDate>
<item>
  <title><![CDATA[Fortaleciendo la Seguridad Informática con Snort y AIDE: Guía Completa]]></title>
  <description><![CDATA[
<div id="outline-container-orgc52fbcf" class="outline-2">
<h2 id="orgc52fbcf">Introducción</h2>
<div class="outline-text-2" id="text-orgc52fbcf">
<p>
La seguridad informática es un aspecto fundamental para cualquier sistema, especialmente en la era digital actual donde las amenazas evolucionan constantemente. En esta guía detallada, exploraremos dos herramientas esenciales para complementar tu estrategia de seguridad: <b>Snort</b> y <b>AIDE</b>.
</p>

<ul class="org-ul">
<li><b>Snort</b>: Un sistema de detección y prevención de intrusiones (IDS/IPS) basado en red que analiza el tráfico en tiempo real para identificar patrones sospechosos.</li>
<li><b>AIDE</b> (Advanced Intrusion Detection Environment): Una herramienta de detección de intrusiones basada en host que monitorea la integridad de los archivos del sistema.</li>
</ul>

<p>
La combinación de estas herramientas proporciona una defensa en profundidad, permitiéndote detectar tanto intrusiones a nivel de red como modificaciones no autorizadas en tus archivos del sistema.
</p>


<figure id="org611842f">
<img src="images/arquitectura-seguridad.png" alt="arquitectura-seguridad.png">

</figure>
</div>
</div>
<div id="outline-container-org55d4434" class="outline-2">
<h2 id="org55d4434">Parte 1: Instalación y Configuración de Snort</h2>
<div class="outline-text-2" id="text-org55d4434">
</div>
<div id="outline-container-orge3efe91" class="outline-3">
<h3 id="orge3efe91">¿Qué es Snort?</h3>
<div class="outline-text-3" id="text-orge3efe91">
<p>
Snort es un sistema de detección y prevención de intrusiones (IDS/IPS) de código abierto, creado por Martin Roesch en 1998. Esta poderosa herramienta analiza el tráfico de red en tiempo real, comparándolo con una base de datos de reglas para identificar posibles ataques, escaneos, exploits y otras actividades maliciosas.
</p>

<p>
Snort puede funcionar en tres modos principales:
</p>
<ol class="org-ol">
<li><b>Modo Sniffer</b>: Simplemente lee los paquetes de la red y los muestra en pantalla.</li>
<li><b>Modo Registro de Paquetes</b>: Guarda los paquetes en el disco para análisis posterior.</li>
<li><b>Modo NIDS</b> (Network Intrusion Detection System): Analiza el tráfico de red en busca de coincidencias con patrones predefinidos.</li>
<li><b>Modo NIPS</b> (Network Intrusion Prevention System): Además de detectar, puede bloquear activamente tráfico malicioso.</li>
</ol>
</div>
</div>
<div id="outline-container-org4a543f2" class="outline-3">
<h3 id="org4a543f2">Requisitos Previos</h3>
<div class="outline-text-3" id="text-org4a543f2">
<p>
Antes de instalar Snort, asegúrate de contar con:
</p>

<ul class="org-ul">
<li>Sistema operativo Linux (esta guía usa Ubuntu/Debian, pero puede adaptarse)</li>
<li>Privilegios de administrador (sudo/root)</li>
<li>Conexión a Internet para descargar paquetes</li>
<li>Libpcap (biblioteca para captura de paquetes)</li>
<li>DAQ (Data Acquisition Library)</li>
</ul>
</div>
</div>
<div id="outline-container-org5fb90e7" class="outline-3">
<h3 id="org5fb90e7">Instalación de Snort en Debian/Ubuntu</h3>
<div class="outline-text-3" id="text-org5fb90e7">
<p>
Primero, instalemos las dependencias necesarias:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo apt update
sudo apt install -y build-essential libpcap-dev libpcre3-dev libnet1-dev <span style="color: #a44185;">\</span>
zlib1g-dev luajit hwloc libdnet-dev libdumbnet-dev bison flex liblzma-dev <span style="color: #a44185;">\</span>
openssl libssl-dev libnghttp2-dev libluajit-5.1-dev pkg-config libhwloc-dev <span style="color: #a44185;">\</span>
cmake cpputest
</pre>
</div>

<p>
A continuación, instalamos Snort desde los repositorios (aunque también veremos cómo compilarlo desde el código fuente):
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo apt install -y snort
</pre>
</div>

<p>
Durante la instalación, se te pedirá configurar tu red local. Introduce el rango de direcciones de tu red (por ejemplo, 192.168.1.0/24).
</p>
</div>
</div>
<div id="outline-container-org671a1aa" class="outline-3">
<h3 id="org671a1aa">Instalación desde el código fuente (alternativa)</h3>
<div class="outline-text-3" id="text-org671a1aa">
<p>
Para tener la versión más reciente, puedes compilar Snort desde el código fuente:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Descargar y compilar DAQ</span>
<span style="color: #dc3eb7;">cd</span> ~/Downloads
wget https://github.com/snort3/libdaq/archive/refs/tags/v3.0.12.tar.gz
tar -xzvf v3.0.12.tar.gz
<span style="color: #dc3eb7;">cd</span> libdaq-3.0.12/
./bootstrap
./configure
make
sudo make install

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Descargar y compilar Snort</span>
<span style="color: #dc3eb7;">cd</span> ~/Downloads
wget https://github.com/snort3/snort3/archive/refs/tags/3.1.76.0.tar.gz
tar -xzvf 3.1.76.0.tar.gz
<span style="color: #dc3eb7;">cd</span> snort3-3.1.76.0/
./configure_cmake.sh --prefix=/usr/local --enable-tcmalloc
<span style="color: #dc3eb7;">cd</span> build
make
sudo make install
sudo ldconfig

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Verificar la instalaci&#243;n</span>
snort -V
</pre>
</div>
</div>
</div>
<div id="outline-container-org22a5aac" class="outline-3">
<h3 id="org22a5aac">Configuración Básica de Snort</h3>
<div class="outline-text-3" id="text-org22a5aac">
<p>
El archivo principal de configuración se encuentra en `/etc/snort/snort.conf` (o en `/usr/local/etc/snort/snort.conf` si compilaste desde el código fuente). Vamos a realizar algunas configuraciones básicas:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo cp /etc/snort/snort.conf /etc/snort/snort.conf.bak  <span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Crear backup</span>
sudo nano /etc/snort/snort.conf
</pre>
</div>

<p>
Dentro del archivo, busca y modifica las siguientes secciones:
</p>

<p>
<b>Configuración de red</b>: Define tu red local para que Snort pueda diferenciar entre tráfico interno y externo.
</p>
<div class="org-src-container">
<pre class="src src-bash">ipvar HOME_NET 192.168.1.0/24
ipvar EXTERNAL_NET !$<span style="color: #1857a4;">HOME_NET</span>
</pre>
</div>

<p>
<b>Rutas de reglas</b>: Asegúrate de que las rutas a los archivos de reglas sean correctas.
</p>
<div class="org-src-container">
<pre class="src src-bash">var RULE_PATH /etc/snort/rules
var SO_RULE_PATH /etc/snort/so_rules
var PREPROC_RULE_PATH /etc/snort/preproc_rules
</pre>
</div>

<p>
<b>Preprocesadores</b>: Habilita los preprocesadores necesarios según tus necesidades:
</p>
<div class="org-src-container">
<pre class="src src-bash">preprocessor frag3_global: max_frags 65536
preprocessor frag3_engine: policy windows detect_anomalies
preprocessor stream5_global: track_tcp yes, track_udp yes
</pre>
</div>

<p>
<b>Reglas</b>: Descomenta las reglas que deseas utilizar:
</p>
<div class="org-src-container">
<pre class="src src-bash">include $<span style="color: #1857a4;">RULE_PATH</span>/local.rules
include $<span style="color: #1857a4;">RULE_PATH</span>/bad-traffic.rules
include $<span style="color: #1857a4;">RULE_PATH</span>/exploit.rules
<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">... otras reglas seg&#250;n necesidades ...</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org3ca258b" class="outline-3">
<h3 id="org3ca258b">Creación de Reglas Personalizadas</h3>
<div class="outline-text-3" id="text-org3ca258b">
<p>
Las reglas de Snort son extremadamente poderosas y flexibles. Vamos a crear algunas reglas personalizadas en el archivo `/etc/snort/rules/local.rules`:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo nano /etc/snort/rules/local.rules
</pre>
</div>

<p>
Añade estas reglas de ejemplo:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Alerta por escaneo de puertos</span>
alert tcp any any -&gt; $<span style="color: #1857a4;">HOME_NET</span> any (msg:<span style="color: #a44185;">"Posible escaneo de puertos TCP"</span>; flags:S; threshold: type threshold, track by_src, count 50, seconds 60; sid:1000001; rev:1;)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Alerta por intentos de acceso SSH m&#250;ltiples</span>
alert tcp any any -&gt; $<span style="color: #1857a4;">HOME_NET</span> 22 (msg:<span style="color: #a44185;">"Posible ataque de fuerza bruta SSH"</span>; flow:to_server; threshold: type threshold, track by_src, count 5, seconds 60; sid:1000002; rev:1;)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Alerta por acceso a la p&#225;gina de administraci&#243;n</span>
alert tcp any any -&gt; $<span style="color: #1857a4;">HOME_NET</span> 80 (msg:<span style="color: #a44185;">"Acceso a panel de administraci&#243;n"</span>; content:<span style="color: #a44185;">"GET /admin"</span>; nocase; sid:1000003; rev:1;)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcb4c5a9" class="outline-3">
<h3 id="orgcb4c5a9">Verificación de la Configuración</h3>
<div class="outline-text-3" id="text-orgcb4c5a9">
<p>
Antes de iniciar Snort, verifica que tu configuración no tenga errores:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo snort -T -c /etc/snort/snort.conf
</pre>
</div>

<p>
Si todo está correcto, deberías ver "Snort successfully validated the configuration!"
</p>
</div>
</div>
<div id="outline-container-org92320c0" class="outline-3">
<h3 id="org92320c0">Ejecución de Snort</h3>
<div class="outline-text-3" id="text-org92320c0">
<p>
Para ejecutar Snort en modo IDS:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo snort -A console -q -c /etc/snort/snort.conf -D
</pre>
</div>

<p>
Opciones comunes:
</p>
<ul class="org-ul">
<li>`-A console`: Muestra las alertas en la consola</li>
<li>`-q`: Modo silencioso</li>
<li>`-c`: Ruta al archivo de configuración</li>
<li>`-D`: Ejecutar como demonio</li>
</ul>

<p>
Para ejecutar Snort en modo IPS (usando NFQ):
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo snort -c /etc/snort/snort.conf -Q --daq nfq --daq-var <span style="color: #1857a4;">queue</span>=1
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdec95e9" class="outline-3">
<h3 id="orgdec95e9">Configuración como Servicio</h3>
<div class="outline-text-3" id="text-orgdec95e9">
<p>
Para que Snort se inicie automáticamente al arrancar el sistema:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo nano /etc/systemd/system/snort.service
</pre>
</div>

<p>
Añade el siguiente contenido:
</p>

<div class="org-src-container">
<pre class="src src-bash">[Unit]
<span style="color: #1857a4;">Description</span>=Snort NIDS Daemon
<span style="color: #1857a4;">After</span>=network.target

[Service]
<span style="color: #1857a4;">Type</span>=simple
<span style="color: #1857a4;">ExecStart</span>=/usr/sbin/snort -c /etc/snort/snort.conf -D
<span style="color: #1857a4;">Restart</span>=on-failure

[Install]
<span style="color: #1857a4;">WantedBy</span>=multi-user.target
</pre>
</div>


<p>
Habilita e inicia el servicio:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo systemctl enable snort.service
sudo systemctl start snort.service
sudo systemctl status snort.service
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdbb5052" class="outline-3">
<h3 id="orgdbb5052">Visualización con diagrama PlantUML</h3>
<div class="outline-text-3" id="text-orgdbb5052">
<p>
El flujo de trabajo de Snort puede representarse visualmente:
</p>


<figure id="org02ef8d8">
<img src="images/flujo-snort.png" alt="flujo-snort.png">

</figure>
</div>
</div>
</div>
<div id="outline-container-orgb698de7" class="outline-2">
<h2 id="orgb698de7">Parte 2: Instalación y Configuración de AIDE</h2>
<div class="outline-text-2" id="text-orgb698de7">
</div>
<div id="outline-container-org8fbecb6" class="outline-3">
<h3 id="org8fbecb6">¿Qué es AIDE?</h3>
<div class="outline-text-3" id="text-org8fbecb6">
<p>
AIDE (Advanced Intrusion Detection Environment) es una herramienta de detección de intrusiones basada en host que verifica la integridad de los archivos del sistema. Funciona creando una base de datos de los atributos de los archivos y directorios, como permisos, timestamps, checksums y contenido. Posteriormente, puede detectar cualquier cambio no autorizado en estos atributos.
</p>

<p>
AIDE es especialmente útil para:
</p>
<ul class="org-ul">
<li>Detectar modificaciones no autorizadas en archivos críticos del sistema</li>
<li>Identificar instalaciones de rootkits o backdoors</li>
<li>Verificar la integridad del sistema tras un incidente de seguridad</li>
<li>Cumplir con requisitos de auditoría y conformidad</li>
</ul>
</div>
</div>
<div id="outline-container-orgadf285a" class="outline-3">
<h3 id="orgadf285a">Instalación de AIDE</h3>
<div class="outline-text-3" id="text-orgadf285a">
<p>
En sistemas Debian/Ubuntu:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo apt update
sudo apt install -y aide
</pre>
</div>

<p>
En sistemas basados en Red Hat (RHEL, CentOS, Fedora):
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo yum install -y aide
<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">o con dnf</span>
sudo dnf install -y aide
</pre>
</div>
</div>
</div>
<div id="outline-container-org1e4fd00" class="outline-3">
<h3 id="org1e4fd00">Configuración Básica de AIDE</h3>
<div class="outline-text-3" id="text-org1e4fd00">
<p>
El archivo principal de configuración se encuentra en `/etc/aide/aide.conf`. Vamos a realizar una configuración básica:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo cp /etc/aide/aide.conf /etc/aide/aide.conf.bak  <span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Crear backup</span>
sudo nano /etc/aide/aide.conf
</pre>
</div>

<p>
El archivo contiene definiciones de grupos de reglas y los directorios/archivos a los que aplicarlas. Aquí hay algunos ejemplos importantes:
</p>

<div class="org-src-container">
<pre class="src src-bash">
<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Definici&#243;n de grupos de reglas</span>
<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">NORMAL = checksums + atributos de archivo + permisos</span>
<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">DATAONLY = solo checksums</span>
<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">LOGS = como NORMAL pero permitiendo cambios en el tama&#241;o</span>
<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">...</span>

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Directorios/archivos a monitorear</span>
/etc NORMAL
/bin NORMAL
/sbin NORMAL
/usr NORMAL
/boot NORMAL
/root NORMAL
<span style="color: #219fd5; font-weight: bold;">!</span>/var/log/.*  <span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Excluir logs - pueden cambiar frecuentemente</span>
<span style="color: #219fd5; font-weight: bold;">!</span>/var/spool/.* <span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Excluir spool</span>
<span style="color: #219fd5; font-weight: bold;">!</span>/var/tmp/.* <span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Excluir temporales</span>

</pre>
</div>
</div>
</div>
<div id="outline-container-orgf7d9ce6" class="outline-3">
<h3 id="orgf7d9ce6">Personalización de la Configuración</h3>
<div class="outline-text-3" id="text-orgf7d9ce6">
<p>
Vamos a personalizar la configuración para adaptarla a nuestras necesidades:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo nano /etc/aide/aide.conf
</pre>
</div>

<p>
Añade o modifica estas líneas según tus necesidades:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Definici&#243;n personalizada de grupos de reglas</span>
MyGroup = sha256+ftype+p+u+g+n+acl+xattrs

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Directorios espec&#237;ficos a monitorear con mayor atenci&#243;n</span>
/etc/ssh MyGroup
/etc/pam.d MyGroup
/etc/sudoers MyGroup
/etc/shadow MyGroup

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Archivos de configuraci&#243;n de Snort</span>
/etc/snort MyGroup

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Excluir directorios que cambian frecuentemente</span>
<span style="color: #219fd5; font-weight: bold;">!</span>/var/lib/mysql/.*
<span style="color: #219fd5; font-weight: bold;">!</span>/home/usuario/descargas/.*
</pre>
</div>
</div>
</div>
<div id="outline-container-org1c1ee8b" class="outline-3">
<h3 id="org1c1ee8b">Inicialización de la Base de Datos de AIDE</h3>
<div class="outline-text-3" id="text-org1c1ee8b">
<p>
Antes de usar AIDE, necesitamos inicializar su base de datos:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo aideinit
<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">o alternativamente</span>
sudo aide --init
</pre>
</div>

<p>
Esto puede tomar tiempo dependiendo del tamaño de tu sistema. Una vez completado, la base de datos se creará en un archivo temporal (generalmente `/var/lib/aide/aide.db.new`). Necesitamos moverla al lugar correcto:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db
</pre>
</div>
</div>
</div>
<div id="outline-container-orgeec7e3a" class="outline-3">
<h3 id="orgeec7e3a">Ejecución Manual de Verificaciones</h3>
<div class="outline-text-3" id="text-orgeec7e3a">
<p>
Para ejecutar una verificación manualmente:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo aide --check
</pre>
</div>

<p>
Este comando comparará el estado actual del sistema con la base de datos almacenada y mostrará cualquier discrepancia.
</p>
</div>
</div>
<div id="outline-container-org0f8d893" class="outline-3">
<h3 id="org0f8d893">Actualización de la Base de Datos</h3>
<div class="outline-text-3" id="text-org0f8d893">
<p>
Después de realizar cambios legítimos en el sistema (como actualizaciones de software), debemos actualizar la base de datos de AIDE:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo aide --update
sudo mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db
</pre>
</div>
</div>
</div>
<div id="outline-container-org154d214" class="outline-3">
<h3 id="org154d214">Automatización con Cron</h3>
<div class="outline-text-3" id="text-org154d214">
<p>
Para automatizar las verificaciones regulares, configuremos una tarea cron:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo nano /etc/cron.daily/aide-check
</pre>
</div>

<p>
Añade este contenido:
</p>

<p>
bash
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8195b0; font-style: italic;">#</span><span style="color: #8195b0; font-style: italic;">!/bin/</span><span style="color: #219fd5; font-style: italic;">bash</span>
<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Verificaci&#243;n diaria con AIDE</span>

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Ruta para almacenar informes</span>
<span style="color: #1857a4;">REPORT_DIR</span>=<span style="color: #a44185;">"/var/log/aide"</span>
<span style="color: #1857a4;">REPORT_FILE</span>=<span style="color: #a44185;">"$REPORT_DIR/aide-$(</span><span style="color: #219fd5; font-weight: bold;">date +%Y%m%d-%H%M%S</span><span style="color: #a44185;">).log"</span>

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Crear directorio si no existe</span>
mkdir -p $<span style="color: #1857a4;">REPORT_DIR</span>

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Ejecutar verificaci&#243;n</span>
/usr/bin/aide --check &gt; $<span style="color: #1857a4;">REPORT_FILE</span> 2&gt;&amp;1

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Si hay cambios, enviar por correo (opcional)</span>
<span style="color: #219fd5; font-style: italic;">if</span> [ $<span style="color: #1857a4;">?</span> -ne 0 ]; <span style="color: #219fd5; font-style: italic;">then</span>
    <span style="color: #dc3eb7;">echo</span> <span style="color: #a44185;">"Se detectaron cambios en el sistema. Ver $REPORT_FILE para detalles."</span> | <span style="color: #a44185;">\</span>
    mail -s <span style="color: #a44185;">"Alerta de AIDE: cambios detectados"</span> admin@example.com
<span style="color: #219fd5; font-style: italic;">fi</span>

<span style="color: #219fd5; font-style: italic;">exit</span> 0
</pre>
</div>

<p>
Haz el script ejecutable:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo chmod +x /etc/cron.daily/aide-check
</pre>
</div>

<p>
También es buena práctica actualizar la base de datos periódicamente:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo nano /etc/cron.weekly/aide-update
</pre>
</div>

<p>
Añade este contenido:
</p>

<p>
bash
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8195b0; font-style: italic;">#</span><span style="color: #8195b0; font-style: italic;">!/bin/</span><span style="color: #219fd5; font-style: italic;">bash</span>
<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Actualizaci&#243;n semanal de la base de datos de AIDE</span>

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Ejecutar actualizaci&#243;n</span>
/usr/bin/aide --update

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Mover la nueva base de datos</span>
mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db

<span style="color: #219fd5; font-style: italic;">exit</span> 0
</pre>
</div>

<p>
Haz el script ejecutable:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo chmod +x /etc/cron.weekly/aide-update
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbd39a86" class="outline-3">
<h3 id="orgbd39a86">Visualización con diagrama PlantUML</h3>
<div class="outline-text-3" id="text-orgbd39a86">
<p>
El flujo de trabajo de AIDE puede representarse visualmente:
</p>


<figure id="orgf20e6b4">
<img src="images/flujo-aide.png" alt="flujo-aide.png">

</figure>
</div>
</div>
</div>
<div id="outline-container-org22551e4" class="outline-2">
<h2 id="org22551e4">Parte 3: Integración de Snort y AIDE para una Defensa Completa</h2>
<div class="outline-text-2" id="text-org22551e4">
</div>
<div id="outline-container-orgc01f187" class="outline-3">
<h3 id="orgc01f187">Estrategia de Defensa en Profundidad</h3>
<div class="outline-text-3" id="text-orgc01f187">
<p>
La combinación de Snort y AIDE proporciona una defensa en profundidad para tu sistema:
</p>

<ol class="org-ol">
<li><b>Snort</b> actúa como primera línea de defensa, monitoreando el tráfico de red y detectando posibles intentos de intrusión antes de que lleguen a comprometer el sistema.</li>

<li><b>AIDE</b> funciona como última línea de defensa, verificando si algún archivo del sistema ha sido modificado, lo que indicaría una posible intrusión exitosa.</li>
</ol>

<p>
Esta estrategia aplica el principio de defensa en profundidad: múltiples capas de seguridad que se complementan para proteger tus sistemas.
</p>
</div>
</div>
<div id="outline-container-orgf6e7931" class="outline-3">
<h3 id="orgf6e7931">Integración a Nivel de Alertas</h3>
<div class="outline-text-3" id="text-orgf6e7931">
<p>
Podemos integrar las alertas de ambas herramientas para tener una vista unificada de posibles incidentes de seguridad:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo nano /etc/aide/aide.sh
</pre>
</div>

<p>
Crea un script que combine los resultados:
</p>

<p>
bash
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8195b0; font-style: italic;">#</span><span style="color: #8195b0; font-style: italic;">!/bin/</span><span style="color: #219fd5; font-style: italic;">bash</span>
<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Script para integrar las alertas de Snort y AIDE</span>

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Directorios de logs</span>
<span style="color: #1857a4;">SNORT_LOG</span>=<span style="color: #a44185;">"/var/log/snort/alert"</span>
<span style="color: #1857a4;">AIDE_LOG</span>=<span style="color: #a44185;">"/var/log/aide/aide-$(</span><span style="color: #219fd5; font-weight: bold;">date +%Y%m%d</span><span style="color: #a44185;">).log"</span>
<span style="color: #1857a4;">COMBINED_LOG</span>=<span style="color: #a44185;">"/var/log/security/combined-$(</span><span style="color: #219fd5; font-weight: bold;">date +%Y%m%d</span><span style="color: #a44185;">).log"</span>

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Crear directorio si no existe</span>
mkdir -p /var/log/security

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Ejecutar verificaci&#243;n de AIDE</span>
<span style="color: #dc3eb7;">echo</span> <span style="color: #a44185;">"Ejecutando verificaci&#243;n de AIDE..."</span> &gt; $<span style="color: #1857a4;">COMBINED_LOG</span>
/usr/bin/aide --check &gt;&gt; $<span style="color: #1857a4;">COMBINED_LOG</span> 2&gt;&amp;1
<span style="color: #dc3eb7;">echo</span> <span style="color: #a44185;">""</span> &gt;&gt; $<span style="color: #1857a4;">COMBINED_LOG</span>

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">A&#241;adir &#250;ltimas alertas de Snort</span>
<span style="color: #dc3eb7;">echo</span> <span style="color: #a44185;">"&#218;ltimas alertas de Snort:"</span> &gt;&gt; $<span style="color: #1857a4;">COMBINED_LOG</span>
tail -n 50 $<span style="color: #1857a4;">SNORT_LOG</span> &gt;&gt; $<span style="color: #1857a4;">COMBINED_LOG</span>
<span style="color: #dc3eb7;">echo</span> <span style="color: #a44185;">""</span> &gt;&gt; $<span style="color: #1857a4;">COMBINED_LOG</span>

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Analizar para detectar correlaciones</span>
<span style="color: #dc3eb7;">echo</span> <span style="color: #a44185;">"An&#225;lisis de correlaci&#243;n:"</span> &gt;&gt; $<span style="color: #1857a4;">COMBINED_LOG</span>
grep -i <span style="color: #a44185;">"modified"</span> $<span style="color: #1857a4;">AIDE_LOG</span> &gt; /tmp/aide_modified.tmp
<span style="color: #219fd5; font-style: italic;">while </span><span style="color: #dc3eb7;">read</span> line; <span style="color: #219fd5; font-style: italic;">do</span>
    <span style="color: #1857a4;">file</span>=$(<span style="color: #219fd5; font-weight: bold;">echo $line | awk '{print $2}'</span>)
    grep -i <span style="color: #a44185;">"$file"</span> $<span style="color: #1857a4;">SNORT_LOG</span> &gt;&gt; $<span style="color: #1857a4;">COMBINED_LOG</span>
<span style="color: #219fd5; font-style: italic;">done</span> &lt; /tmp/aide_modified.tmp

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Enviar informe (opcional)</span>
cat $<span style="color: #1857a4;">COMBINED_LOG</span> | mail -s <span style="color: #a44185;">"Informe de Seguridad Diario"</span> admin@example.com

<span style="color: #219fd5; font-style: italic;">exit</span> 0
</pre>
</div>

<p>
Haz el script ejecutable y configúralo como tarea cron diaria:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo chmod +x /etc/aide/aide.sh
sudo nano /etc/cron.daily/security-check
</pre>
</div>

<p>
Añade este contenido:
</p>

<p>
bash
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8195b0; font-style: italic;">#</span><span style="color: #8195b0; font-style: italic;">!/bin/</span><span style="color: #219fd5; font-style: italic;">bash</span>
/etc/aide/aide.sh
</pre>
</div>

<p>
Haz el script ejecutable:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo chmod +x /etc/cron.daily/security-check
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb0c877a" class="outline-3">
<h3 id="orgb0c877a">Visualización con diagrama PlantUML</h3>
<div class="outline-text-3" id="text-orgb0c877a">
<p>
La integración entre Snort y AIDE puede representarse visualmente:
</p>


<figure id="orgdd0bbbe">
<img src="images/integracion-snort-aide.png" alt="integracion-snort-aide.png">

</figure>
</div>
</div>
</div>
<div id="outline-container-org8de54e5" class="outline-2">
<h2 id="org8de54e5">Parte 4: Mejores Prácticas y Mantenimiento</h2>
<div class="outline-text-2" id="text-org8de54e5">
</div>
<div id="outline-container-org9885b7c" class="outline-3">
<h3 id="org9885b7c">Actualización de Reglas de Snort</h3>
<div class="outline-text-3" id="text-org9885b7c">
<p>
Las reglas de Snort deben actualizarse regularmente para detectar las últimas amenazas:
</p>

<ol class="org-ol">
<li><b>Suscripción a Reglas</b>: Considera una suscripción a Snort VRT para obtener las últimas reglas comerciales.</li>

<li><b>Reglas de la Comunidad</b>: Alternativamente, puedes usar reglas gratuitas de la comunidad.</li>

<li><b>Actualización Automática</b>: Configura un script para actualizar las reglas periódicamente:</li>
</ol>

<div class="org-src-container">
<pre class="src src-bash">sudo nano /etc/cron.daily/update-snort-rules
</pre>
</div>

<p>
bash
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8195b0; font-style: italic;">#</span><span style="color: #8195b0; font-style: italic;">!/bin/</span><span style="color: #219fd5; font-style: italic;">bash</span>
<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Actualizaci&#243;n diaria de reglas de Snort</span>

<span style="color: #dc3eb7;">cd</span> /etc/snort/rules
wget -q https://www.snort.org/rules/community -O community.tar.gz
tar -xzf community.tar.gz
rm community.tar.gz

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Reiniciar Snort para aplicar las nuevas reglas</span>
systemctl restart snort.service
</pre>
</div>

<p>
Haz el script ejecutable:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo chmod +x /etc/cron.daily/update-snort-rules
</pre>
</div>
</div>
</div>
<div id="outline-container-org4971c25" class="outline-3">
<h3 id="org4971c25">Ajuste y Optimización de Rendimiento</h3>
<div class="outline-text-3" id="text-org4971c25">
<p>
Para optimizar el rendimiento de Snort:
</p>

<p>
<b>Ajusta los preprocesadores</b>: Habilita solo los preprocesadores necesarios para tu entorno.
</p>

<p>
<b>Optimiza la memoria</b>: Ajusta los parámetros de memoria según tus recursos disponibles.
</p>
<div class="org-src-container">
<pre class="src src-bash">config detection: search-method ac-bnfa
config detection: max_queue_events 5
</pre>
</div>

<p>
<b>Filtra tráfico irrelevante</b>: Usa BPF (Berkeley Packet Filter) para filtrar tráfico que no necesitas analizar:
</p>
<div class="org-src-container">
<pre class="src src-bash">config bpf_file: /etc/snort/bpf.conf


En <span style="color: #219fd5; font-weight: bold;">`/etc/snort/bpf.conf`</span>:

not port 53 and not port 80
</pre>
</div>
</div>
</div>
<div id="outline-container-org92e7f11" class="outline-3">
<h3 id="org92e7f11">Copia de Seguridad y Recuperación</h3>
<div class="outline-text-3" id="text-org92e7f11">
<p>
Realizar copias de seguridad regulares de tus configuraciones:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo nano /etc/cron.weekly/security-backup
</pre>
</div>

<p>
bash
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8195b0; font-style: italic;">#</span><span style="color: #8195b0; font-style: italic;">!/bin/</span><span style="color: #219fd5; font-style: italic;">bash</span>
<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Copia de seguridad semanal de configuraciones de seguridad</span>

<span style="color: #1857a4;">BACKUP_DIR</span>=<span style="color: #a44185;">"/backup/security/$(</span><span style="color: #219fd5; font-weight: bold;">date +%Y%m%d</span><span style="color: #a44185;">)"</span>
mkdir -p $<span style="color: #1857a4;">BACKUP_DIR</span>

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Backup de configuraci&#243;n de Snort</span>
tar -czf $<span style="color: #1857a4;">BACKUP_DIR</span>/snort-config.tar.gz /etc/snort

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Backup de configuraci&#243;n de AIDE</span>
cp /etc/aide/aide.conf $<span style="color: #1857a4;">BACKUP_DIR</span>/
cp /var/lib/aide/aide.db $<span style="color: #1857a4;">BACKUP_DIR</span>/

<span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Backup de logs (opcional)</span>
tar -czf $<span style="color: #1857a4;">BACKUP_DIR</span>/security-logs.tar.gz /var/log/snort /var/log/aide

<span style="color: #219fd5; font-style: italic;">exit</span> 0
</pre>
</div>


<p>
Haz el script ejecutable:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo chmod +x /etc/cron.weekly/security-backup
</pre>
</div>
</div>
</div>
<div id="outline-container-org2f92bbe" class="outline-3">
<h3 id="org2f92bbe">Pruebas de Efectividad</h3>
<div class="outline-text-3" id="text-org2f92bbe">
<p>
Es importante probar regularmente la efectividad de tu configuración:
</p>

<ol class="org-ol">
<li><b>Para Snort</b>: Utiliza herramientas como `nmap` o `hping3` para generar tráfico sospechoso de forma controlada y verifica que Snort lo detecte.</li>
</ol>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Desde otra m&#225;quina (&#161;NO desde producci&#243;n!)</span>
sudo nmap -sS -p 1-1000 [IP-objetivo]
</pre>
</div>

<ol class="org-ol">
<li><b>Para AIDE</b>: Realiza cambios controlados en archivos monitoreados y verifica que AIDE los detecte.</li>
</ol>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Modificar un archivo monitoreado</span>
sudo touch /etc/test-file
sudo aide --check  <span style="color: #8195b0; font-style: italic;"># </span><span style="color: #8195b0; font-style: italic;">Deber&#237;a mostrar el cambio</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org2853484" class="outline-3">
<h3 id="org2853484">Plan de Respuesta a Incidentes</h3>
<div class="outline-text-3" id="text-org2853484">
<p>
Desarrolla un plan simple de respuesta a incidentes:
</p>

<ol class="org-ol">
<li><b>Detección</b>: Monitoreo constante de logs y alertas.</li>
<li><b>Contención</b>: Procedimientos para aislar sistemas comprometidos.</li>
<li><b>Erradicación</b>: Eliminación de amenazas identificadas.</li>
<li><b>Recuperación</b>: Restauración de sistemas a un estado seguro.</li>
<li><b>Lecciones aprendidas</b>: Documentación y mejora continua.</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org171b1d7" class="outline-2">
<h2 id="org171b1d7">Conclusión</h2>
<div class="outline-text-2" id="text-org171b1d7">
<p>
La combinación de Snort (IDS/IPS basado en red) y AIDE (verificación de integridad basada en host) proporciona una estrategia de defensa en profundidad para proteger tus sistemas informáticos. Mientras Snort vigila el perímetro y detecta intentos de intrusión, AIDE verifica que ningún archivo crítico haya sido modificado sin autorización.
</p>

<p>
La configuración e integración adecuada de estas herramientas, junto con un mantenimiento regular y pruebas periódicas, te permitirá mantener un nivel de seguridad robusto frente a las constantes amenazas del entorno digital.
</p>

<p>
Recuerda que la seguridad informática es un proceso continuo, no un producto. Mantente actualizado sobre las últimas amenazas y técnicas de protección, y adapta tu estrategia de seguridad en consecuencia.
</p>
</div>
</div>
<div id="outline-container-orgd7376b9" class="outline-2">
<h2 id="orgd7376b9">Referencias y Recursos Adicionales</h2>
<div class="outline-text-2" id="text-orgd7376b9">
<ul class="org-ul">
<li><a href="https://www.snort.org/">Sitio oficial de Snort</a></li>
<li><a href="https://github.com/aide/aide">Repositorio de AIDE en GitHub</a></li>
<li><a href="https://www.snort.org/documents/snort-users-manual">Manual de usuario de Snort</a></li>
<li><a href="https://aide.github.io/">Documentación de AIDE</a></li>
<li><a href="https://www.sans.org/security-resources/">Recursos de seguridad de SANS Institute</a></li>
</ul>
</div>
</div>
<div id="outline-container-org2b4e454" class="outline-2">
<h2 id="org2b4e454">Notas para el Editor de Emacs</h2>
<div class="outline-text-2" id="text-org2b4e454">
</div>
</div>
<div class="taglist"><a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tags.html">Categoría</a>: <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-seguridad.html">seguridad</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-informática.html">informática</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-nort.html">nort</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-aide.html">AIDE</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-ids.html">IDS</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-ips.html">IPS</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-detección.html">detección</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-intrusiones.html">intrusiones</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-monitoreo.html">monitoreo</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-integridad.html">integridad</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-emacs.html">emacs</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-linux.html">linux</a> <a href="https://mcasrom.github.io/Blogging-con-Emacs-y-AI/tag-tutoriales.html">tutoriales</a> </div>]]></description>
  <category><![CDATA[seguridad]]></category>
  <category><![CDATA[informática]]></category>
  <category><![CDATA[nort]]></category>
  <category><![CDATA[AIDE]]></category>
  <category><![CDATA[IDS]]></category>
  <category><![CDATA[IPS]]></category>
  <category><![CDATA[detección]]></category>
  <category><![CDATA[intrusiones]]></category>
  <category><![CDATA[monitoreo]]></category>
  <category><![CDATA[integridad]]></category>
  <category><![CDATA[emacs]]></category>
  <category><![CDATA[linux]]></category>
  <category><![CDATA[tutoriales]]></category>
  <link>https://mcasrom.github.io/Blogging-con-Emacs-y-AI/2025-04-16--fortaleciendo-la-seguridad-inform-tica-con-snort-y-aide-gu-a-completa.html</link>
  <guid>https://mcasrom.github.io/Blogging-con-Emacs-y-AI/2025-04-16--fortaleciendo-la-seguridad-inform-tica-con-snort-y-aide-gu-a-completa.html</guid>
  <pubDate>Wed, 16 Apr 2025 04:17:00 +0200</pubDate>
</item>
</channel>
</rss>
